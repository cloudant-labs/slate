<html lang="en">
<head>
  <title>IBM&reg; Cloudant&reg; NoSQL DB for Bluemix&reg;</title>
  <meta charset="utf-8"></meta>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
  <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
</head>

<body>
  <h1 id="attachments">Attachments</h1>
  <p class="shortdesc">Another way to store data is to use attachments. Attachments are Binary Large Object (<a href="http://en.wikipedia.org/wiki/Binary_large_object" target="_blank">BLOB <img src="../images/launch-glyph.svg" alt="External link icon" title="External link icon"></a>)
    files contained within documents.</p>
  <p>The BLOB is stored in the <code>_attachments</code> component of the document. The BLOB holds data including:</p>
  <ul>
    <li>The attachment name.</li>
    <li>The type of the attachment.</li>
    <li>The actual content.</li>
  </ul>
  <p>Examples of BLOBs would be images and multimedia.</p>
  <blockquote>
    <p> <strong>Note</strong>: If you include the attachment as an &#39;<a href="#inline">inline</a>&#39; component of the overall JSON, the attachment content should be represented using BASE64 form.</p>
  </blockquote>
  <p>The content type corresponds to a <a href="http://en.wikipedia.org/wiki/Internet_media_type#List_of_common_media_types" target="_blank">MIME type <img src="../images/launch-glyph.svg" alt="External link icon" title="External link icon"></a>. For example,
    if you want to attach a <code>.jpg</code> image file to a document, you specify the attachment MIME type as <code>image/jpeg</code>.</p>
  <blockquote>
    <p> <strong>Note</strong>: As a best practice, keep attachments small in size and number because attachments can impact performance.</p>
  </blockquote>
  <h2 id="create-update">Create / Update</h2>
  <p>To create a new attachment at the same time as creating a new document, include the attachment as an &#39;<a href="#inline">inline</a>&#39; component of the JSON content.</p>
  <p>To create a new attachment on an existing document, or to update an attachment on a document, make a PUT request with the document&#39;s latest <code>_rev</code> to <code>https://$USERNAME.cloudant.com/$DATABASE/$DOCUMENT_ID/$ATTACHMENT</code>. The
    attachment&#39;s <a href="http://en.wikipedia.org/wiki/Internet_media_type#List_of_common_media_types" target="_blank">content type <img src="../images/launch-glyph.svg" alt="External link icon" title="External link icon"></a> must be specified using
    the <code>Content-Type</code> header. The <code>$ATTACHMENT</code> value is the name by which the attachment is associated with the document.</p>
  <blockquote>
    <p> <strong>Note</strong>: You can create more than one attachment for a document by ensuring that the <code>$ATTACHMENT</code> value for each attachment is unique within the document.</p>
  </blockquote>
  <p><em>Example instruction for creating or updating an attachment, using HTTP:</em></p>
  <pre class="codeblock"><code class="lang-HTTP hljs"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/$DATABASE/$DOCUMENT_ID/$ATTACHMENT?rev=$REV</span> HTTP/1.1
<span class="hljs-attribute">Content-Type</span>: $$ATTACHMENT_MIME_TYPE
</code></pre>
  <p><em>Example instruction for creating or updating an attachment, using the command line:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>:<span class="hljs-variable">$PASSWORD</span>@<span class="hljs-variable">$USERNAME</span>.cloudant.com/<span class="hljs-variable">$DATABASE</span>/<span class="hljs-variable">$DOCUMENT_ID</span>/<span class="hljs-variable">$ATTACHMENT</span>?rev=<span class="hljs-variable">$REV</span> \
     -X PUT \
     -H <span class="hljs-string">"Content-Type: <span class="hljs-variable">$ATTACHMENT_MIME_TYPE</span>"</span> \
     --data-binary @<span class="hljs-variable">$ATTACHMENT_FILEPATH</span>
</code></pre>
  <!--

_Example instruction for creating or updating an attachment, using Javascript:_

```javascript
var nano = require('nano');
var fs = require('fs');
var account = nano("https://$USERNAME:$PASSWORD@$USERNAME.cloudant.com");
var db = account.use($DATABASE);
fs.readFile($FILEPATH, function (err, data) {
    if (!err) {
        db.attachment.insert($DOCUMENT_ID, $ATTACHMENT, data, $ATTACHMENT_MIME_TYPE, {
            rev: $REV
        },
        function (err, body) {
            if (!err)
                console.log(body);
        }
    }
});
```

-->

  <p>The response contains the document ID and the new document revision.</p>
  <blockquote>
    <p> <strong>Note</strong>: Attachments do not have their own revisions. Instead, updating or creating an attachment changes the revision of the document it is attached to.</p>
  </blockquote>
  <p><em>Example response:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"id"</span> : <span class="hljs-string">"FishStew"</span>,
    <span class="hljs-attr">"ok"</span> : <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"rev"</span> : <span class="hljs-string">"9-247bb19a41bfd9bfdaf5ee6e2e05be74"</span>
}
</code></pre>
  <h2 id="read">Read</h2>
  <p>To retrieve an attachment, make a <code>GET</code> request to <code>https://$USERNAME.cloudant.com/$DATABASE/$DOCUMENT_ID/$ATTACHMENT</code>. The body of the response is the raw content of the attachment.</p>
  <p><em>Example of reading an attachment, using HTTP:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">GET</span> <span class="hljs-string">/$DATABASE/$DOCUMENT_ID/$ATTACHMENT</span> HTTP/1.1
</code></pre>
  <p><em>Example of reading an attachment, using the command line:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>.cloudant.com/<span class="hljs-variable">$DATABASE</span>/<span class="hljs-variable">$DOCUMENT_ID</span>/<span class="hljs-variable">$ATTACHMENT</span> \
     -u <span class="hljs-variable">$USERNAME</span> &gt;blob_content.dat
<span class="hljs-comment"># store the response content into a file for further processing.</span>
</code></pre>
  <!--

_Example of reading an attachment, using Javascript:_

```javascript
var nano = require('nano');
var account = nano("https://$USERNAME:$PASSWORD@$USERNAME.cloudant.com");
var db = account.use($DATABASE);
db.attachment.get($DOCUMENT_ID, $FILENAME, function (err, body) {
    if (!err) {
        console.log(body);
    }
});
```

-->

  <h2 id="delete">Delete</h2>
  <p>To delete an attachment, make a <code>DELETE</code> request with the document&#39;s latest <code>_rev</code> to <code>https://$USERNAME.cloudant.com/$DATABASE/$DOCUMENT_ID/$ATTACHMENT</code>. If you do not supply the latest <code>_rev</code>, the response
    is a <a href="http.html#409">409 error</a>.</p>
  <p><em>Example of deleting an attachment, using HTTP:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">DELETE</span> <span class="hljs-string">/$DATABASE/$DOCUMENT_ID/$ATTACHMENT?rev=$REV</span> HTTP/1.1
</code></pre>
  <p><em>Example of deleting an attachment, using the command line:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>.cloudant.com/<span class="hljs-variable">$DATABASE</span>/<span class="hljs-variable">$DOCUMENT_ID</span>/<span class="hljs-variable">$ATTACHMENT</span>?rev=<span class="hljs-variable">$REV</span> \
    -u <span class="hljs-variable">$USERNAME</span> \
    -X DELETE
</code></pre>
  <!--

_Example of deleting an attachment, using Javascript:_

```javascript
var nano = require('nano');
var account = nano("https://$USERNAME:$PASSWORD@$USERNAME.cloudant.com");
var db = account.use($DATABASE);
db.attachment.destroy($DOCUMENT_ID, $FILENAME, $REV, function (err, body) {
    if (!err) {
        console.log(body);
    }
});
```

-->

  <p>If the deletion is successful, the response contains <code>&quot;ok&quot;: true</code>, and the ID and new revision of the document.</p>
  <p><em>Example response after successfuly deleting an attachment:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"ok"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"DocID"</span>,
    <span class="hljs-attr">"rev"</span>: <span class="hljs-string">"3-aedfb06537c1d77a087eb295571f7fc9"</span>
}
</code></pre>
  <h2 id="inline">Inline</h2>
  <p>Inline attachments are attachments included as part of the JSON content. The content must be provided using <a href="https://en.wikipedia.org/wiki/Base64" target="_blank">BASE64 <img src="../images/launch-glyph.svg" alt="External link icon" title="External link icon"></a>    representation, as shown in the example.</p>
  <p>A full list of media types is available
    <a href="http://en.wikipedia.org/wiki/Internet_media_type#List_of_common_media_types" target="_blank">here <img src="../images/launch-glyph.svg" alt="External link icon" title="External link icon"></a>.</p>
  <p><em>Example JSON document that includes an inline attachment of a jpeg image:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"_id"</span>:<span class="hljs-string">"document_with_attachment"</span>,
    <span class="hljs-attr">"_attachments"</span>:
    {
        <span class="hljs-attr">"name_of_attachment"</span>: {
            <span class="hljs-attr">"content_type"</span>:<span class="hljs-string">"image/jpeg"</span>,
            <span class="hljs-attr">"data"</span>: <span class="hljs-string">"iVBORw0KGgoAA... ...AASUVORK5CYII="</span>
        }
    }
}
</code></pre>
  <h2 id="performance-considerations">Performance considerations</h2>
  <p>While document attachments are very useful, they do have implications for application performance. In particular, having a large number of attachments can have an adverse performance impact during replication.</p>
  <p>For example, if your application requires lots of images to be stored as attachments, or has large images, a better approach would be to use an alternative <a href="https://en.wikipedia.org/wiki/Binary_large_object" target="_blank">BLOB <img src="../images/launch-glyph.svg" alt="External link icon" title="External link icon"></a>    storage mechanism for the images. You could then use Cloudant to keep the image metadata, such as URLs to the BLOB store.</p>
  <p>You might find it helpful to carry out performance testing for your specific application to determine which approach works best for your circumstances.</p>
  <footer>
    <div>
      <p>Copyright &copy; 2015, 2017. All Rights Reserved.</p>
    </div>
  </footer>
</body>
</html>