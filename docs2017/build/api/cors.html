<html lang="en">
<head>
  <title>IBM&reg; Cloudant&reg; NoSQL DB for Bluemix&reg;</title>
  <meta charset="utf-8"></meta>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
  <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
</head>

<body>
  <h1 id="cors">CORS</h1>
  <p class="shortdesc"><a href="http://www.w3.org/TR/cors/" target="_blank">Cross-origin resource sharing (CORS) <img src="../images/launch-glyph.svg" alt="External link icon" title="External link icon"></a> is a mechanism that allows resources such as JSON documents in a
    Cloudant database to be requested from Javascript running on a website loaded from another domain.</p>
  <p>These &quot;cross-domain&quot; requests would normally be forbidden by web browsers, due to the <a href="http://en.wikipedia.org/wiki/Same-origin_policy" target="_blank">same origin security policy <img src="../images/launch-glyph.svg" alt="External link icon" title="External link icon"></a>.</p>
  <p>CORS defines a way in which the browser and the server interact to determine whether or not to allow the request. For Cloudant, there are two use cases in which CORS might be a good solution.</p>
  <ol>
    <li>You have a website on <code>https://www.example.com</code> and you want scripts on this website to be able to access data from <code>https://example.cloudant.com</code>. To do this, add <code>https://www.example.com</code> to your list of allowed
      origins. The effect is that scripts loaded from this domain are then allowed to make AJAX requests to your Cloudant databases. By using HTTP authorization with CORS requests, users of your application are able to access their database only.</li>
    <li>You want to allow third parties access to your database. An example might be where you have a database that contains product information, and you want to give sales partners access to the information from Javascript running on their own domain. To
      do this, add their domain to your list of allowed origins. The effect is that scripts running on their website are able to access your Cloudant database.</li>
  </ol>
  <h2 id="browser-support">Browser support</h2>
  <p>CORS is supported by all current versions of commonly used browsers.</p>
  <blockquote>
    <p> <strong>Note</strong>: Versions of Microsoft Internet Explorer prior to version 10 offer partial support for CORS. Versions of Microsoft Internet Explorer prior to version 8 do not support CORS.</p>
  </blockquote>
  <h2 id="security">Security</h2>
  <p>Storing sensitive data in databases that can be accessed using CORS is a potential security risk. When you place a domain in the list of allowed origins, you are trusting any of the Javascript from the domain. If the web application running on the domain
    is running malicious code or has security vulnerabilities, sensitive data in your database might be exposed.</p>
  <p>In addition, allowing scripts to be loaded using HTTP rather than HTTPS, and then accessing data using CORS, introduces the risk that a man in the middle attack might modify the scripts.</p>
  <p>To reduce the risk:</p>
  <ul>
    <li>Don&#39;t allow CORS requests from all origins. In other words, do not set <code>&quot;origins&quot;: [&quot;*&quot;]</code> unless you are certain that:
      <ul>
        <li>You want to allow all data in your databases to be publicly accessible.</li>
        <li>User credentials that give permission to modify data are never used in a browser.</li>
      </ul>
    </li>
    <li>Allow CORS requests only from HTTPS origins, not HTTP.</li>
    <li>Ensure that web applications running on allowed origin domains are trusted and do not have security vulnerabilities.</li>
  </ul>
  <h2 id="configuration-endpoints">Configuration endpoints</h2>
  <table>
    <thead>
      <tr>
        <th>Method</th>
        <th>Path</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>GET</code></td>
        <td><code>/_api/v2/user/config/cors</code></td>
        <td>Returns the current CORS configuration.</td>
      </tr>
      <tr>
        <td><code>PUT</code></td>
        <td><code>/_api/v2/user/config/cors</code></td>
        <td>Changes the CORS configuration.</td>
      </tr>
    </tbody>
  </table>
  <h2 id="json-format">JSON format</h2>
  <ul>
    <li><strong>enable_cors</strong>: boolean value to turn CORS on or off.</li>
    <li><strong>allow_credentials</strong>: boolean value to allow authentication credentials. If set to true, browser requests must be done using <code>withCredentials = true</code>.</li>
    <li><strong>origins</strong>: An array of strings containing allowed origin domains. You have to specify the full URL including the protocol. It is recommended that only the HTTPS protocol is used. Subdomains count as seperate domains, so you have to
      specify all subdomains used. See the following example request.</li>
  </ul>
  <h2 id="setting-the-cors-configuration">Setting the CORS configuration</h2>
  <p><code>PUT</code>ting a JSON document with the example structure to <code>/_api/v2/user/config/cors</code> sets the CORS configuration. The configuration applies to all databases and all account level endpoints in your account.</p>
  <p><em>Example request, using HTTP:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/_api/v2/user/config/cors</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: $USERNAME.cloudant.com
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
  <p><em>Example request, using the command line:</em> </p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>:<span class="hljs-variable">$PASSWORD</span>@<span class="hljs-variable">$USERNAME</span>.cloudant.com/_api/v2/user/config/cors \
    -H <span class="hljs-string">'Content-Type: application/json'</span> \
    -X PUT \
    -T cors.json
</code></pre>
  <p><em>Example JSON file for setting the CORS configuration:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"enable_cors"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"allow_credentials"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"origins"</span>: [
        <span class="hljs-string">"https://example.com"</span>,
        <span class="hljs-string">"https://www.example.com"</span>
    ]
}
</code></pre>
  <p>The response tells you whether the configuration has been updated successfully.</p>
  <p><em>Example response:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"ok"</span>: <span class="hljs-literal">true</span>
}
</code></pre>
  <h2 id="reading-the-cors-configuration">Reading the CORS configuration</h2>
  <p>You can find out the current CORS configuration by sending a <code>GET</code> to the <code>/_api/v2/user/config/cors</code> endpoint.</p>
  <p><em>Example request to <code>GET</code> the current CORS configuration, using HTTP:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">GET</span> <span class="hljs-string">/_api/v2/user/config/cors</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: username.cloudant.com
</code></pre>
  <p><em>Example request to <code>GET</code> the current CORS configuration, using the command line:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>:<span class="hljs-variable">$PASSWORD</span>@<span class="hljs-variable">$USERNAME</span>.cloudant.com/_api/v2/user/config/cors
</code></pre>
  <p>The response is the current CORS configuration in a JSON document.</p>
  <p><em>Example response:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"enable_cors"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"allow_credentials"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"origins"</span>: [
        <span class="hljs-string">"https://example.com"</span>,
        <span class="hljs-string">"https://www.example.com"</span>
    ]
}
</code></pre>
  <h2 id="dashboard">Dashboard</h2>
  <p>CORS support is available in the Cloudant dashboard.</p>
  <p>You can update your CORS settings using the CORS tab within the dashboard:</p>
  <p><img src="../images/corsdashboard.png" alt="CORS dashboard illustration"></p>
  <p>To see the current CORS configuration, simply open the CORS tab in the dashboard.</p>
  <p>You can enable or disable CORS using the <code>Enable CORS</code> checkbox. This corresponds to the <a href="#configuration-endpoints"><code>enable_cors</code> option</a> when changing the CORS configuration from within an application.</p>
  <p>To specify that CORS is enabled for all domains, select the <code>All domains (*)</code> option.</p>
  <p>To specify that CORS is enabled only for exact origin domains, list each of the domains or subdomains using the <code>Restrict to specific domains</code> option. For each domain, provide a full URL, preferably using the <code>https</code> prefix for
    additional security.</p>
  <footer>
    <div>
      <p>Copyright &copy; 2015, 2017. All Rights Reserved.</p>
    </div>
  </footer>
</body>
</html>