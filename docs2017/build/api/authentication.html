<html lang="en">
<head>
  <title>IBM&reg; Cloudant&reg; NoSQL DB for Bluemix&reg;</title>
  <meta charset="utf-8"></meta>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
  <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
</head>

<body>
  <h1 id="authentication">Authentication</h1>
  <p class="shortdesc">Authentication means proving who you are. This is typically done by providing your user credentials for verification.</p>
  <p>There are two ways that clients can provide credentials (authenticate) for Cloudant:</p>
  <ul>
    <li><a href="#basic-authentication">Basic authentication</a>.</li>
    <li><a href="#cookie-authentication">Cookie authentication</a>.</li>
  </ul>
  <p>Basic authentication is similar to showing an ID at a door, to be checked every time you want to enter. Cookie authentication is similar to having a key to the door so that you can let yourself in whenever you want. Within Cloudant, the key is a cookie
    named <code>AuthSession</code>.</p>
  <blockquote>
    <p> <strong>Note</strong>: When creating or using performance-critical Cloudant applications, Cookie authentication has benefits compared with Basic authentication. Therefore, you should prefer Cookie authentication where possible.</p>
  </blockquote>
  <h2 id="basic-authentication">Basic Authentication</h2>
  <p>To use Basic authentication, pass along your credentials as part of every request. You do this by adding an <code>Authorization</code> header to the request.</p>
  <p>The header contains the authentication scheme (<code>Basic</code>), followed by the <a href="https://en.wikipedia.org/wiki/Base64" target="_blank">BASE64 <img src="../images/launch-glyph.svg" alt="External link icon" title="External link icon"></a>    encoding of a string created by concatenating:</p>
  <ul>
    <li>Your username.</li>
    <li>The <code>:</code> character.</li>
    <li>Your password.</li>
  </ul>
  <p>In practice, many application libraries that are used for creating HTTP requests can do this encoding for you.</p>
  <p><em>Example including basic authentication credentials in a request, using HTTP:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">GET</span> <span class="hljs-string">/db/document</span> HTTP/1.1
<span class="hljs-attribute">Authorization</span>: Basic dXNlcm5hbWU6cGFzc3dvcmQ=
</code></pre>
  <p><em>Example including basic authentication credentials in a request, using the command line:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>:<span class="hljs-variable">$PASSWORD</span>@<span class="hljs-variable">$USERNAME</span>.cloudant.com
</code></pre>
  <!--

_Example including basic authentication credentials in a request, using Javascript:_

```javascript
var nano = require('nano');
var account = nano("https://$USERNAME:$PASSWORD@$USERNAME.cloudant.com");
account.request(function (err, body) {
    if (!err) {
        console.log(body);
    }
});
```

-->

  <p><em>Example including basic authentication credentials in a request, using Python:</em></p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-keyword">import</span> cloudant
url = <span class="hljs-string">"https://{0}:{1}@{0}.cloudant.com"</span>.format(USERNAME, PASSWORD)
account = cloudant.Account(url)
ping = account.get()
<span class="hljs-keyword">print</span> ping.status_code
<span class="hljs-comment"># Expected result code: 200</span>
</code></pre>
  <h2 id="cookie-authentication">Cookie Authentication</h2>
  <p>Cookie authentication requires you to supply a valid username and password once, at the start of a series of tasks (the session). The response includes a cookie, generated by the server, that confirms you have successfully authenticated. Once created,
    you send the cookie with all requests that require you to be authenticated.</p>
  <p>The presence of a valid cookie is sufficient to ensure that your call request is processed rather than rejected immediately as unauthenticated. You can use the cookie until it expires.</p>
  <p>Using the <code>DELETE</code> method has the effect of logging the user out, because the cookie is considered by the server to have expired.</p>
  <table>
    <thead>
      <tr>
        <th>Method</th>
        <th>Path</th>
        <th>Description</th>
        <th>Headers</th>
        <th>Form Parameters</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>POST</code></td>
        <td><code>/_session</code></td>
        <td>Do cookie based user login</td>
        <td><code>Content-Type: application/x-www-form-urlencoded</code></td>
        <td>name, password</td>
      </tr>
      <tr>
        <td><code>GET</code></td>
        <td><code>/_session</code></td>
        <td>Returns cookie based login user information</td>
        <td>AuthSession cookie returned by POST request</td>
        <td>—</td>
      </tr>
      <tr>
        <td><code>DELETE</code></td>
        <td><code>/_session</code></td>
        <td>Logout cookie based user</td>
        <td>AuthSession cookie returned by POST request</td>
        <td>—</td>
      </tr>
    </tbody>
  </table>
  <h3 id="requesting-a-cookie">Requesting a cookie</h3>
  <p>With Cookie authentication, you use your credentials to acquire a cookie. Do this by sending a <code>POST</code> request to <code>/_session</code>.</p>
  <p><em>Example of requesting a cookie, using HTTP:</em></p>
  <pre class="codeblock"><code class="lang-http hljs">POST /_session HTTP/1.1
Content-Length: 32
Content-Type: application/x-www-form-urlencoded
Accept: */*
name=USERNAME&amp;password=PASSWORD
</code></pre>
  <p><em>Example of requesting a cookie, using the command line:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>.cloudant.com/_session \
    -X POST \
    -c /path/to/cookiefile
    <span class="hljs-_">-d</span> <span class="hljs-string">"name=<span class="hljs-variable">$USERNAME</span>&amp;password=<span class="hljs-variable">$PASSWORD</span>"</span>
</code></pre>
  <!--

_Example of requesting a cookie, using Javascript:_

```javascript
var nano = require('nano');
var cloudant = nano("https://"+$USERNAME+".cloudant.com");
var cookies = {}
cloudant.auth($USERNAME, $PASSWORD, function (err, body, headers) {
    if (!err) {
        cookies[$USERNAME] = headers['set-cookie'];
        cloudant = nano({
            url: "https://"+$USERNAME+".cloudant.com",
            cookie: cookies[$USERNAME] 
        });
        // ping to ensure we're logged in
        cloudant.request({
            path: 'test_porter'
        }, function (err, body, headers) {
            if (!err) {
                console.log(body, headers);
            }
        });
    }
});
```

-->

  <p><em>Example of requesting a cookie, using Python:</em></p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-keyword">import</span> cloudant
account = cloudant.Account(USERNAME)
login = account.login(USERNAME, PASSWORD)
<span class="hljs-keyword">print</span> login.status_code
<span class="hljs-comment"># Expected result code: 200</span>
logout = account.logout()
<span class="hljs-keyword">print</span> logout.status_code
<span class="hljs-comment"># Expected result code: 200</span>
all_dbs = account.all_dbs()
<span class="hljs-keyword">print</span> all_dbs.status_code
<span class="hljs-comment"># Expected result code: 401</span>
</code></pre>
  <p>If the credentials you supply in your cookie request are valid, the response contains a cookie which remains active for twenty-four hours.</p>
  <p><em>Reply to request for a cookie:</em></p>
  <pre class="codeblock"><code class="lang-http hljs">200 OK
Cache-Control: must-revalidate
Content-Length: 42
Content-Type: text/plain; charset=UTF-8
Date: Mon, 11 Nov 2016 12:43:15 GMT
server: CouchDB/1.0.2 (Erlang OTP/R14B)
Set-Cookie: AuthSession=&quot;d2FybWFuYTo1ODI1QkM2NzpZelovo2epvx9cfaDdxJGNLuzBzw&quot;; Expires=Sat, 12 Nov 2016 12:43:15 GMT; Max-Age=86400; Path=/; HttpOnly; Version=1
x-couch-request-id: a638431d
</code></pre>
  <p><em>JSON part of response:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"ok"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"USERNAME"</span>,
    <span class="hljs-attr">"roles"</span>: []
}
</code></pre>
  <div id="getting-cookie-information"></div>
  <h3 id="getting-cookie-authenticated-information">Getting cookie-authenticated information</h3>
  <p>When a cookie has been set, information about the authenticated user can be retrieved with a <code>GET</code> request.</p>
  <p><em>Example request for cookie information, using HTTP:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">GET</span> <span class="hljs-string">/_session</span> HTTP/1.1
<span class="hljs-attribute">Cookie</span>: AuthSession="d2FybWFuYTo1ODI1QkM2NzpZelovo2epvx9cfaDdxJGNLuzBzw"; Expires=Sat, 12 Nov 2016 12:43:15 GMT; Max-Age=86400; Path=/; HttpOnly; Version=1
<span class="hljs-attribute">Accept</span>: application/json
</code></pre>
  <p><em>Example request for cookie information, using the command line:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>.cloudant.com/_session \
    -X GET \
    -b /path/to/cookiefile
</code></pre>
  <p>The response contains the username, the user&#39;s roles, and which authentication mechanism was used.</p>
  <p><em>Example response to request for cookie information:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"userCtx"</span>: {
        <span class="hljs-attr">"roles"</span>: [
            <span class="hljs-string">"_admin"</span>,
            <span class="hljs-string">"_reader"</span>,
            <span class="hljs-string">"_writer"</span>
        ],
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"USERNAME"</span>
    },
    <span class="hljs-attr">"ok"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"info"</span>: {
        <span class="hljs-attr">"authentication_db"</span>: <span class="hljs-string">"_users"</span>,
        <span class="hljs-attr">"authentication_handlers"</span>: [
            <span class="hljs-string">"delegated"</span>,
            <span class="hljs-string">"cookie"</span>,
            <span class="hljs-string">"default"</span>,
            <span class="hljs-string">"local"</span>
        ],
        <span class="hljs-attr">"authenticated"</span>: <span class="hljs-string">"cookie"</span>
    }
}
</code></pre>
  <h3 id="deleting-a-cookie">Deleting a cookie</h3>
  <p>You can end the cookie authentication session by sending a <code>DELETE</code> request to the same URL used to create the cookie. The <code>DELETE</code> request must include the cookie you wish to delete.</p>
  <p><em>Example cookie <code>DELETE</code> request, using HTTP:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">DELETE</span> <span class="hljs-string">/_session</span> HTTP/1.1
<span class="hljs-attribute">Cookie</span>: AuthSession="d2FybWFuYTo1ODI1QkM2NzpZelovo2epvx9cfaDdxJGNLuzBzw"; Expires=Sat, 12 Nov 2016 12:43:15 GMT; Max-Age=86400; Path=/; HttpOnly; Version=1
<span class="hljs-attribute">Accept</span>: application/json
</code></pre>
  <p><em>Example cookie <code>DELETE</code> request, using the command line:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>.cloudant.com/_session \
    -X DELETE \
    -b /path/to/cookiefile
</code></pre>
  <p>The response confirms deletion of the session, and sets the <code>AuthSession</code> Cookie to <code>&quot;&quot;</code>.</p>
  <p><em>Example response to cookie <code>DELETE</code> request:</em></p>
  <pre class="codeblock"><code class="lang-http hljs">200 OK
Cache-Control: must-revalidate
Content-Length: 12
Content-Type: application/json
Date: Mon, 11 Nov 2016 14:06:12 GMT
server: CouchDB/1.0.2 (Erlang OTP/R14B)
Set-Cookie: AuthSession=&quot;&quot;; Expires=Fri, 02 Jan 1970 00:00:00 GMT; Max-Age=0; Path=/; HttpOnly; Version=1
x-couch-request-id: e02e0333
</code></pre>
  <p><em>JSON part of response:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"ok"</span>: <span class="hljs-literal">true</span>
}
</code></pre>
  <footer>
    <div>
      <p>Copyright &copy; 2015, 2017. All Rights Reserved.</p>
    </div>
  </footer>
</body>
</html>