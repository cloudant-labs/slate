<html lang="en">
<head>
  <title>IBM&reg; Cloudant&reg; NoSQL DB for Bluemix&reg;</title>
  <meta charset="utf-8"></meta>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
  <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
</head>

<body>
  <!-- Acrolinx: 2017-03-02 -->

  <h1 id="databases">Databases</h1>
  <p class="shortdesc">Cloudant databases contain JSON objects. These JSON objects are called <a href="document.html#documents">documents</a>. All documents must be contained in a database.</p>
  <p>A guide is <a href="../guides/transactions.html">available</a>, providing an example of how documents for an e-commerce application might be used within a Cloudant database.</p>
  <p>A more complex database application, involving extra storage, processing, and analytics tasks, is referred to as a <a href="../guides/warehousing.html">warehouse</a>.<br>Warehouses are also supported by Cloudant.</p>
  <h2 id="create">Create</h2>
  <p>To create a database, send a <code>PUT</code> request to <code>https://$USERNAME.cloudant.com/$DATABASE</code>.</p>
  <p>The database name must start with a lowercase letter, and contain only the following characters:</p>
  <ul>
    <li>Lowercase characters (a-z)</li>
    <li>Digits (0-9)</li>
    <li>Any of the characters _, $, (, ), +, -, and /</li>
  </ul>
  <p><em>Example of using HTTP to create a database:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/$DATABASE</span> HTTP/1.1
<span class="hljs-attribute">HOST</span>: $ACCOUNT.cloudant.com
</code></pre>
  <p><em>Example of using the command line to create a database:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>:<span class="hljs-variable">$PASSWORD</span>@<span class="hljs-variable">$ACCOUNT</span>.cloudant.com/<span class="hljs-variable">$DATABASE</span> -X PUT
</code></pre>
  <!--

_Example of using JavaScript to create a database:_

```javascript
var nano = require('nano');
var account = nano("https://"+$USERNAME+":"+$PASSWORD+"@"+$USERNAME+".cloudant.com");

account.db.create($DATABASE, function (err, body, headers) {
    if (!err) {
        console.log('database created!');
    }
});
```

-->

  <div id="response"></div>
  <p>If creation succeeds, you get a <a href="http.html#201">201 or 202 response</a>. An error response uses the HTTP status code to indicate what went wrong.</p>
  <table>
    <thead>
      <tr>
        <th>Code</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>201</td>
        <td>Database created successfully</td>
      </tr>
      <tr>
        <td>202</td>
        <td>The database was successfully created on some nodes, but the number of nodes is less than the write quorum.</td>
      </tr>
      <tr>
        <td>403</td>
        <td>Invalid database name.</td>
      </tr>
      <tr>
        <td>412</td>
        <td>Database already exists.</td>
      </tr>
    </tbody>
  </table>
  <p><em>Example response that is received after a database is created successfully:</em></p>
  <pre class="codeblock"><code class="lang-http hljs">HTTP/1.1 <span class="hljs-number">201</span> Created

<span class="1c">{
    ok<span class="hljs-string">": true</span>
}</span>
</code></pre>
  <h3 id="database-topology">Database topology</h3>
  <p>It is possible to modify the configuration of a sharding topology for a database on dedicated database clusters. This modification can be done when the database is created. However, poor choices for configuration parameters can adversely affect database
    performance.</p>
  <p>For more information about modifying database configuration in a dedicated database environment, contact Cloudant support.</p>
  <blockquote>
    <p><strong>Note</strong>: It is not possible to modify the configuration that is used for databases on multi-tenant clusters.</p>
  </blockquote>
  <div id="read"></div>
  <h2 id="getting-database-details">Getting database details</h2>
  <p>Sending a <code>GET</code> request to <code>https://$USERNAME.cloudant.com/$DATABASE</code> returns details about the database, such as how many documents it contains.</p>
  <p><em>Example of using HTTP to get database details:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">GET</span> <span class="hljs-string">/$DATABASE</span> HTTP/1.1
</code></pre>
  <p><em>Example of using the command line to get database details:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>.cloudant.com/<span class="hljs-variable">$DATABASE</span> \
    -u <span class="hljs-variable">$USERNAME</span>
</code></pre>
  <!--

_Example of using JavaScript to get database details:_

```javascript
var nano = require('nano');
var account = nano("https://"+$USERNAME+":"+$PASSWORD+"@"+$USERNAME+".cloudant.com");

account.db.get($DATABASE, function (err, body, headers) {
    if (!err) {
        console.log(body);
    }
});
```

-->

  <p>The elements of the returned structure are shown in the following table:</p>
  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>compact_running</code></td>
        <td>Set to true if the database compaction routine is operating on this database.</td>
      </tr>
      <tr>
        <td><code>db_name</code></td>
        <td>The name of the database.</td>
      </tr>
      <tr>
        <td><code>disk_format_version</code></td>
        <td>The version of the physical format that is used for the data when it is stored on disk.</td>
      </tr>
      <tr>
        <td><code>disk_size</code></td>
        <td>Size in bytes of the data as stored on the disk. Views indexes are not included in the calculation.</td>
      </tr>
      <tr>
        <td><code>doc_count</code></td>
        <td>A count of the documents in the specified database.</td>
      </tr>
      <tr>
        <td><code>doc_del_count</code></td>
        <td>Number of deleted documents.</td>
      </tr>
      <tr>
        <td><code>instance_start_time</code></td>
        <td>Always 0.</td>
      </tr>
      <tr>
        <td><code>other</code></td>
        <td>JSON object that contains a <code>data_size</code> field.</td>
      </tr>
      <tr>
        <td><code>purge_seq</code></td>
        <td>The number of purge operations on the database.</td>
      </tr>
      <tr>
        <td><code>sizes</code></td>
        <td>A JSON object, containing <code>file</code>, <code>external</code>, and <code>active</code> sizes. <code>active</code> is the size in bytes of data that are stored internally (excluding old revisions). <code>external</code> is the size in bytes
          of decompressed user data. This value is the billable data size. The <code>other/data_size</code> field is an alias for the <code>external</code> field. <code>file</code> is the size in bytes of data that are stored on the disk. Indexes are
          not included in the calculation. The <code>disk_size</code> field is an alias for the <code>file</code> field. This size includes data that are waiting for compaction.</td>
      </tr>
      <tr>
        <td><code>update_seq</code></td>
        <td>An opaque string that describes the state of the database. Do not rely on this string for counting the number of updates.</td>
      </tr>
    </tbody>
  </table>
  <p><em>Example (abbreviated) response that contains database details:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"update_seq"</span>: <span class="hljs-string">"982...uUQ"</span>,
    <span class="hljs-attr">"db_name"</span>: <span class="hljs-string">"db"</span>,
    <span class="hljs-attr">"sizes"</span>: {
        <span class="hljs-attr">"file"</span>: <span class="hljs-number">46114703224</span>,
        <span class="hljs-attr">"external"</span>: <span class="hljs-number">193164408719</span>,
        <span class="hljs-attr">"active"</span>: <span class="hljs-number">34961621142</span>
    },
    <span class="hljs-attr">"purge_seq"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"other"</span>: {
        <span class="hljs-attr">"data_size"</span>: <span class="hljs-number">193164408719</span>
    },
    <span class="hljs-attr">"doc_del_count"</span>: <span class="hljs-number">5564</span>,
    <span class="hljs-attr">"doc_count"</span>: <span class="hljs-number">9818541</span>,
    <span class="hljs-attr">"disk_size"</span>: <span class="hljs-number">46114703224</span>,
    <span class="hljs-attr">"disk_format_version"</span>: <span class="hljs-number">6</span>,
    <span class="hljs-attr">"compact_running"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"instance_start_time"</span>: <span class="hljs-string">"0"</span>
}
</code></pre>
  <div id="get-databases"></div>
  <h2 id="get-a-list-of-all-databases-in-the-account">Get a list of all databases in the account</h2>
  <p>To list all the databases in an account, send a <code>GET</code> request to <code>https://$USERNAME.cloudant.com/_all_dbs</code>.</p>
  <p><em>Example of using HTTP to list all databases:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">GET</span> <span class="hljs-string">/_all_dbs</span> HTTP/1.1
</code></pre>
  <p><em>Example of using the command line to list all databases:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>.cloudant.com/_all_dbs \
     -u <span class="hljs-variable">$USERNAME</span>
</code></pre>
  <!--

_Example of using JavaScript to list all databases:_

```javascript
var nano = require('nano');
var account = nano("https://"+$USERNAME+":"+$PASSWORD+"@"+$USERNAME+".cloudant.com");

account.db.list(function (err, body, headers) {
  if (!err) {
    console.log(body);
  }
});
```

-->

  <p>The response is a JSON array with all the database names.</p>
  <p><em>Example response:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">[
    <span class="hljs-string">"_users"</span>,
    <span class="hljs-string">"contacts"</span>,
    <span class="hljs-string">"docs"</span>,
    <span class="hljs-string">"invoices"</span>,
    <span class="hljs-string">"locations"</span>
]
</code></pre>
  <h2 id="get-documents">Get Documents</h2>
  <p>To list all the documents in a database, send a <code>GET</code> request to <code>https://$USERNAME.cloudant.com/$DATABASE/_all_docs</code>.</p>
  <p>The <code>_all_docs</code> endpoint accepts the following query arguments:</p>
  <table>
    <thead>
      <tr>
        <th>Argument</th>
        <th>Description</th>
        <th>Optional</th>
        <th>Type</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>conflicts</code></td>
        <td>Can be set only if <code>include_docs</code> is <code>true</code>. Adds information about conflicts to each document.</td>
        <td>yes</td>
        <td>boolean</td>
        <td>false</td>
      </tr>
      <tr>
        <td><code>deleted_conflicts</code></td>
        <td>Returns information about deleted conflicted revisions.</td>
        <td>yes</td>
        <td>boolean</td>
        <td>false</td>
      </tr>
      <tr>
        <td><code>descending</code></td>
        <td>Return the documents in descending key order.</td>
        <td>yes</td>
        <td>boolean</td>
        <td>false</td>
      </tr>
      <tr>
        <td><code>endkey</code></td>
        <td>Stop returning records when the specified key is reached.</td>
        <td>yes</td>
        <td>string</td>
        <td></td>
      </tr>
      <tr>
        <td><code>include_docs</code></td>
        <td>Include the full content of the documents in the return.</td>
        <td>yes</td>
        <td>boolean</td>
        <td>false</td>
      </tr>
      <tr>
        <td><code>inclusive_end</code></td>
        <td>Include rows whose key equals the &#39;<code>endkey</code>&#39; value.</td>
        <td>yes</td>
        <td>boolean</td>
        <td>true</td>
      </tr>
      <tr>
        <td><code>key</code></td>
        <td>Return only documents with IDs that match the specified key.</td>
        <td>yes</td>
        <td>string</td>
        <td></td>
      </tr>
      <tr>
        <td><code>keys</code></td>
        <td>Return only documents with IDs that match one of the specified keys.</td>
        <td>yes</td>
        <td>list of strings</td>
        <td></td>
      </tr>
      <tr>
        <td><code>limit</code></td>
        <td>Limit the number of returned documents to the specified number.</td>
        <td>yes</td>
        <td>numeric</td>
        <td></td>
      </tr>
      <tr>
        <td><code>meta</code></td>
        <td>Short-hand combination of all three arguments: <code>conflicts</code>, <code>deleted_conflicts</code>, and <code>revs_info</code>. Using <code>meta=true</code> is the same as using <code>conflicts=true&amp;deleted_conflicts=true&amp;revs_info=true</code>.</td>
        <td>yes</td>
        <td>boolean</td>
        <td>false</td>
      </tr>
      <tr>
        <td><code>r</code></td>
        <td>Specify the <a href="document.html#quorum---writing-and-reading-data">read quorum</a> value.</td>
        <td>yes</td>
        <td>numeric</td>
        <td>2</td>
      </tr>
      <tr>
        <td><code>revs_info</code></td>
        <td>Includes detailed information for all known document revisions.</td>
        <td>yes</td>
        <td>boolean</td>
        <td>false</td>
      </tr>
      <tr>
        <td><code>skip</code></td>
        <td>Skip this number of records before returning the results.</td>
        <td>yes</td>
        <td>numeric</td>
        <td>0</td>
      </tr>
      <tr>
        <td><code>startkey</code></td>
        <td>Return records, starting with the specified key.</td>
        <td>yes</td>
        <td>string</td>
        <td></td>
      </tr>
    </tbody>
  </table>
  <blockquote>
    <p> <strong>Note</strong>: Using <code>include_docs=true</code> might have <a href="using_views.html#include_docs_caveat">performance implications</a>.</p>
    <p> <strong>Note</strong>: When you use the <code>keys</code> argument, it might be easier to send a <code>POST</code> request rather than a <code>GET</code> request if you require many strings to list the keys you want.</p>
  </blockquote>
  <p><em>Example of using HTTP to list all documents in a database:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">GET</span> <span class="hljs-string">/_all_docs</span> HTTP/1.1
</code></pre>
  <p><em>Example of using the command line to list all documents in a database,</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>:<span class="hljs-variable">$PASSWORD</span>@<span class="hljs-variable">$USERNAME</span>.cloudant.com/<span class="hljs-variable">$DATABASE</span>/_all_docs
</code></pre>
  <!--

_Example of using JavaScript to list all documents in a database:_

```javascript
var nano = require('nano');
var account = nano("https://"+$USERNAME+":"+$PASSWORD+"@"+$USERNAME+".cloudant.com");
var db = account.use($DATABASE);

db.list(function (err, body, headers) {
  if (!err) {
    console.log(body);
  }
});
```

-->

  <p><em>Example of using HTTP to list all documents in a database that match at least one of the specified keys:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">GET</span> <span class="hljs-string">/_all_docs?keys=["somekey","someotherkey"]</span> HTTP/1.1
</code></pre>
  <p><em>Example of using the command line to list all documents in a database that match at least one of the specified keys:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>:<span class="hljs-variable">$PASSWORD</span>@<span class="hljs-variable">$USERNAME</span>.cloudant.com/<span class="hljs-variable">$DATABASE</span>/_all_docs?keys=[<span class="hljs-string">"somekey"</span>,<span class="hljs-string">"someotherkey"</span>]
</code></pre>
  <p>The response is a JSON object that contains all documents in the database that match the parameters. The following table describes the meaning of the individual fields:</p>
  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Description</th>
        <th>Type</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>offset</code></td>
        <td>Offset where the document list started.</td>
        <td>numeric</td>
      </tr>
      <tr>
        <td><code>rows</code></td>
        <td>Array of document objects.</td>
        <td>array</td>
      </tr>
      <tr>
        <td><code>total_rows</code></td>
        <td>Number of documents in the database or view that match the parameters of the query.</td>
        <td>numeric</td>
      </tr>
      <tr>
        <td><code>update_seq</code></td>
        <td>Current update sequence for the database.</td>
        <td>string</td>
      </tr>
    </tbody>
  </table>
  <p><em>Example response after a request for all documents in a database:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"total_rows"</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">"offset"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"rows"</span>: [
        {
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"5a049246-179f-42ad-87ac-8f080426c17c"</span>,
            <span class="hljs-attr">"key"</span>: <span class="hljs-string">"5a049246-179f-42ad-87ac-8f080426c17c"</span>,
            <span class="hljs-attr">"value"</span>: {
                <span class="hljs-attr">"rev"</span>: <span class="hljs-string">"2-9d5401898196997853b5ac4163857a29"</span>
            }
        },
        {
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"96f898f0-f6ff-4a9b-aac4-503992f31b01"</span>,
            <span class="hljs-attr">"key"</span>: <span class="hljs-string">"96f898f0-f6ff-4a9b-aac4-503992f31b01"</span>,
            <span class="hljs-attr">"value"</span>: {
                <span class="hljs-attr">"rev"</span>: <span class="hljs-string">"2-ff7b85665c4c297838963c80ecf481a3"</span>
            }
        },
        {
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"d1f61e66-7708-4da6-aa05-7cbc33b44b7e"</span>,
            <span class="hljs-attr">"key"</span>: <span class="hljs-string">"d1f61e66-7708-4da6-aa05-7cbc33b44b7e"</span>,
            <span class="hljs-attr">"value"</span>: {
                <span class="hljs-attr">"rev"</span>: <span class="hljs-string">"2-cbdef49ef3ddc127eff86350844a6108"</span>
            }
        }
    ]
}
</code></pre>
  <h2 id="get-changes">Get Changes</h2>
  <p>Sending a <code>GET</code> request to <code>https://$USERNAME.cloudant.com/$DATABASE/_changes</code> returns a list of changes that were made to documents in the database, including insertions, updates, and deletions.</p>
  <p>When a <code>_changes</code> request is received, one replica for each shard of the database is asked to provide a list of changes. These responses are combined and returned to the original requesting client.</p>
  <p><code>_changes</code> accepts several optional query arguments:</p>
  <table>
    <thead>
      <tr>
        <th>Argument</th>
        <th>Description</th>
        <th>Supported Values</th>
        <th>Default </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>conflicts</code></td>
        <td>Can be set only if <code>include_docs</code> is <code>true</code>. Adds information about conflicts to each document.</td>
        <td>boolean</td>
        <td>false </td>
      </tr>
      <tr>
        <td><code>descending</code></td>
        <td>Return the changes in sequential order.</td>
        <td>boolean</td>
        <td>false</td>
        <td></td>
      </tr>
      <tr>
        <td><code>doc_ids</code></td>
        <td>To be used only when <code>filter</code> is set to <code>_doc_ids</code>. Filters the feed so that only changes to the specified documents are sent. <strong>Note</strong>: The <code>doc_ids</code> parameter works only with versions of Cloudant
          that are compatible with CouchDB 2.0. See <a href="advanced.html#get-/">API: GET / documentation</a> for more information.</td>
        <td>A JSON array of document IDs</td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td><code>feed</code></td>
        <td>Type of feed required. For details, see the <a href="#the-feed-argument"><code>feed</code> information</a>.</td>
        <td><code>&quot;continuous&quot;</code>, <code>&quot;longpoll&quot;</code>, <code>&quot;normal&quot;</code></td>
        <td><code>&quot;normal&quot;</code></td>
      </tr>
      <tr>
        <td><code>filter</code></td>
        <td>Name of <a href="design_documents.html#filter-functions">filter function</a> to use to get updates. The filter is defined in a <a href="design_documents.html">design document</a>.</td>
        <td>string</td>
        <td>no filter</td>
      </tr>
      <tr>
        <td><code>heartbeat</code></td>
        <td>If there were no changes during <code>feed=longpoll</code> or <code>feed=continuous</code>, an empty line is sent after this time in milliseconds.</td>
        <td>any positive number</td>
        <td>no heartbeat</td>
        <td></td>
      </tr>
      <tr>
        <td><code>include_docs</code></td>
        <td>Include the document as part of the result.</td>
        <td>boolean</td>
        <td>false</td>
        <td></td>
      </tr>
      <tr>
        <td><code>limit</code></td>
        <td>Maximum number of rows to return.</td>
        <td>any non-negative number</td>
        <td>none</td>
        <td></td>
      </tr>
      <tr>
        <td><code>since</code></td>
        <td>Start the results from changes <em>after</em> the specified sequence identifier. For details, see the <a href="#the-since-argument"><code>since</code> information</a>.</td>
        <td>sequence identifier or <code>now</code></td>
        <td>0</td>
        <td></td>
      </tr>
      <tr>
        <td><code>style</code></td>
        <td>Specifies how many revisions are returned in the changes array. The <code>main_only</code> style returns only the current &quot;winning&quot; revision. The <code>all_docs</code> style returns all leaf revisions, including conflicts and deleted
          former conflicts.</td>
        <td><code>main_only</code>, <code>all_docs</code></td>
        <td><code>main_only</code></td>
        <td></td>
      </tr>
      <tr>
        <td><code>timeout</code></td>
        <td>Stop the response after waiting this number of milliseconds for data. If the <code>heartbeat</code> setting is also supplied, it takes precedence over the <code>timeout</code> setting.</td>
        <td>any positive number</td>
        <td></td>
        <td></td>
      </tr>
    </tbody>
  </table>
  <blockquote>
    <p> <strong>Note</strong>: Using <code>include_docs=true</code> might have
      <a href="using_views.html#include_docs_caveat">performance implications</a>.</p>
  </blockquote>
  <p><em>Example of using HTTP to get a list of changes made to documents in a database:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">GET</span> <span class="hljs-string">/$DATABASE/_changes</span> HTTP/1.1
</code></pre>
  <p><em>Example of using the command line to get a list of changes made to documents in a database</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>.cloudant.com/<span class="hljs-variable">$DATABASE</span>/_changes \
     -u <span class="hljs-variable">$USERNAME</span>
</code></pre>
  <!--

_Example of using JavaScript to get a list of changes made to documents in a database:_

```javascript
var nano = require('nano');
var account = nano("https://"+$USERNAME+":"+$PASSWORD+"@"+$USERNAME+".cloudant.com");

account.db.changes($DATABASE, function (err, body, headers) {
    if (!err) {
        console.log(body);
    }
});
```

-->

  <h3 id="changes-in-a-distributed-database">Changes in a distributed database</h3>
  <p>Cloudant databases are distributed. They have shard and fault-tolerant characteristics. These characteristics mean that the responses that are provided by the <code>_changes</code> request might be different from the behavior you expect.</p>
  <p>In particular, if you ask for a list of changes <code>_since</code> a sequence identifier, you get the requested information in response.
    <em>But</em> you might also get changes that were made before the change indicated by the sequence identifier. The reason these extra changes are included, along with the implications for applications, is explained in the
    <a href="../guides/replication_guide.html#how-does-replication-affect-the-list-of-changes?">replication guide</a>.</p>
  <!-- Reset markdown parser -->

  <blockquote>
    <p><strong>Note</strong>: Any application that uses the <code>_changes</code> request <em>must</em> be able to process correctly a list of changes that might:
      <ul>
        <li>Have a different order for the changes that are listed in the response, when compared with an earlier request for the same information.</li>
        <li>Include changes that are considered to be before the change specified by the sequence identifier.</li>
      </ul>
    </p>
  </blockquote>
  <h3 id="the-feed-argument">The <code>feed</code> argument</h3>
  <p>The <code>feed</code> argument changes how Cloudant sends the response. By default,
    <code>_changes</code> reports all changes, then the connection closes. This behavior is the same as using the <code>feed=normal</code> argument.</p>
  <p>If you set <code>feed=longpoll</code>, requests sent to the server remain open until changes are reported. This option helps when monitoring changes continuously.</p>
  <div id="continuous-feed"></div>
  <p>If you set <code>feed=continuous</code>, new changes are reported without closing the connection. This option means that the database connection stays open until explicitly closed, and that all changes are returned to the client as soon as possible
    after they occur.</p>
  <p>Each line in the continuous response is either empty or a JSON object that represents a single change. The option ensures that:</p>
  <ul>
    <li>The format of the report entries reflects the continuous nature of the changes.</li>
    <li>Validity of the JSON output is maintained.</li>
  </ul>
  <p><em>Example (abbreviated) responses from a continuous changes feed:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    &quot;seq&quot;: &quot;1-g1A...qyw&quot;,
    &quot;id&quot;: &quot;2documentation22d01513-c30f-417b-8c27-56b3c0de12ac&quot;,
    &quot;changes&quot;: [
        {
            &quot;rev&quot;: &quot;1-967a00dff5e02add41819138abb3284d&quot;
        }
    ]
},
{
    &quot;seq&quot;: &quot;2-g1A...ssQ&quot;,
    &quot;id&quot;: &quot;1documentation22d01513-c30f-417b-8c27-56b3c0de12ac&quot;,
    &quot;changes&quot;: [
        {
            &quot;rev&quot;: &quot;1-967a00dff5e02add41819138abb3284d&quot;
        }
    ]
},
{
    &quot;seq&quot;: &quot;3-g1A...qyy&quot;,
    &quot;id&quot;: &quot;1documentation22d01513-c30f-417b-8c27-56b3c0de12ac&quot;,
    &quot;changes&quot;: [
        {
            &quot;rev&quot;: &quot;2-eec205a9d413992850a6e32678485900&quot;
        }
    ],
    &quot;deleted&quot;: true
},
{
    &quot;seq&quot;: &quot;4-g1A...qyz&quot;,
    &quot;id&quot;: &quot;2documentation22d01513-c30f-417b-8c27-56b3c0de12ac&quot;,
    &quot;changes&quot;: [
        {
            &quot;rev&quot;: &quot;2-eec205a9d413992850a6e32678485900&quot;
        }
    ],
    &quot;deleted&quot;: true
}
</code></pre>
  <h3 id="the-filter-argument">The <code>filter</code> argument</h3>
  <p>The <code>filter</code> argument designates a pre-defined
    <a href="design_documents.html#filter-functions">filter function</a> to apply to the changes feed. Additionally, several built-in filters available:</p>
  <ul>
    <li><code>_design</code>: The <code>_design</code> filter accepts only changes to design documents.</li>
    <li>
      <p><code>_doc_ids</code>: This filter accepts only changes for documents whose ID is specified in the <code>doc_ids</code> parameter.</p>
      <blockquote>
        <p> <strong>Note</strong>: The <code>_docs_ids</code> parameter works only with versions of Cloudant that are compatible with CouchDB 2.0.</p>
      </blockquote>
    </li>
    <li>
      <p><code>_selector</code>: Accepts only changes for documents that match a specified selector, which is defined by using the same <a href="cloudant_query.html#selector-syntax">selector syntax</a> that is used for <a href="cloudant_query.html#finding-documents-using-an-index"><code>_find</code></a>.</p>
      <blockquote>
        <p> <strong>Note</strong>: The <code>_selector</code> parameter works only with versions of Cloudant that are compatible with CouchDB 2.0.</p>
      </blockquote>
    </li>
    <li><code>_view</code>: Enables use of an existing <a href="creating_views.html#a-simple-view">map function</a> as the filter.</li>
  </ul>
  <h3 id="the-since-argument">The <code>since</code> argument</h3>
  <p>Use the <code>since</code> argument to get a list of changes that occurred <em>after</em> a specified sequence identifier. If the <code>since</code> identifier is 0 (the default), or omitted, the request returns all changes. If the <code>since</code>    identifier is <code>now</code>, the request asks for changes that are made after the current time.</p>
  <p>The distributed nature of Cloudant can affect the results that you get in a response. For example, if you request a list of changes twice, by using the same <code>since</code> sequence identifier both times, the order of changes in the resulting list
    might not be the same.</p>
  <p>You might also see some results that appear to be from <em>before</em> the <code>since</code> parameter. The reason is that you might be getting results from a different replica of a shard (a shard replica).</p>
  <p>Therefore, shard replicas automatically and continuously replicate to each other and eventually have the same data. However, at any point in time, a shard replica might differ from another shard replica because the replication between them is not yet
    complete.</p>
  <p>When you request a list of changes, normally the same replicas are used to respond. But if the node that holds the shard replica is not available, the system substitutes a corresponding shard replica that is held on another node. To help ensure that
    you see all the applicable changes, the most recent checkpoint between the replicas is used. Using the checkpoint is effectively &#39;rolling back&#39; the list of changes to the most recent point in time when the shard replicas were confirmed to
    agree with each other. This &#39;rolling back&#39; means you might see changes listed that took place &#39;before&#39; the <code>since</code> sequence identifier you supplied.</p>
  <p>Your application must be able to deal with a change that is reported more than one time if you make a <code>_changes</code> request several times.</p>
  <p>More information about the behavior of the <code>_changes</code> response is provided in the
    <a href="../guides/replication_guide.html#how-does-replication-affect-the-list-of-changes?">replication guide</a>.</p>
  <div id="changes_responses"></div>
  <h3 id="responses-from-the-_changes-request">Responses from the <code>_changes</code> request</h3>
  <p>The response from a <code>_changes</code> request is a JSON object that contains a list of the changes that were made to documents within the database. The following table describes the meaning of the individual fields:</p>
  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Description</th>
        <th>Type</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>changes</code></td>
        <td>An array that lists the changes that were made to the specific document.</td>
        <td>Array</td>
      </tr>
      <tr>
        <td><code>deleted</code></td>
        <td>Boolean indicating whether the corresponding document was deleted. If present, it always has the value <code>true</code>.</td>
        <td>Boolean</td>
      </tr>
      <tr>
        <td><code>id</code></td>
        <td>Document identifier.</td>
        <td>String</td>
      </tr>
      <tr>
        <td><code>last_seq</code></td>
        <td>Identifier of the last of the sequence identifiers. Currently, this identifier is the same as the sequence identifier of the last item in the <code>results</code>.</td>
        <td>String</td>
      </tr>
      <tr>
        <td><code>results</code></td>
        <td>Array of changes that were made to the database.</td>
        <td>Array</td>
      </tr>
      <tr>
        <td><code>seq</code></td>
        <td>Update sequence identifier.</td>
        <td>String</td>
      </tr>
    </tbody>
  </table>
  <p><em>Example (abbreviated) response to a <code>_changes</code> request:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"results"</span>: [
        {
            <span class="hljs-attr">"seq"</span>: <span class="hljs-string">"1-g1A...sIg"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"foo"</span>,
            <span class="hljs-attr">"changes"</span>: [
                {
                    <span class="hljs-attr">"rev"</span>: <span class="hljs-string">"1-967...84d"</span>
                }
            ]
        }
    ],
    <span class="hljs-attr">"last_seq"</span>: <span class="hljs-string">"1-g1A...sIg"</span>,
    <span class="hljs-attr">"pending"</span>: <span class="hljs-number">0</span>
}
</code></pre>
  <h3 id="important-notes-about-_changes-">Important notes about <code>_changes</code></h3>
  <ul>
    <li>The results that are returned by <code>_changes</code> are partially ordered. In other words, the order might not be preserved for multiple calls. You might decide to get a current list by using <code>_changes</code> and including the <a href="#changes_responses"><code>last_seq</code> value</a>.
      The resulting list provides the starting point for subsequent <code>_changes</code> lists that use the <code>since</code> query argument.</li>
    <li>Although shard copies of the same range contain the same data, their <code>_changes</code> history is often unique. This difference is a result of how writes were applied to the shard. For example, they might be applied in a different order. To be
      sure that all changes are reported for your specified sequence, it might be necessary to go further back into the shard&#39;s history to find a suitable starting point. The changes are then reported from that starting point. This &#39;rolling back&#39;
      might give the appearance of duplicate updates, or updates that are apparently before the specified <code>since</code> value.</li>
    <li><code>_changes</code> reported by a shard are always presented in order. But the ordering between all the contributing shards might appear to be different. For more information, see <a href="https://gist.github.com/smithsz/30fb97662c549061e581" target="_blank">this example <img src="../images/launch-glyph.svg" alt="External link icon" title="External link icon"></a>.</li>
    <li>Sequence values are unique for a shard, but might vary between shards. This variation means that if you have sequence values from different shards, you cannot assume that the same sequence value refers to the same document within the different shards.</li>
  </ul>
  <div id="post"></div>
  <h3 id="using-post-to-get-changes">Using <code>POST</code> to get changes</h3>
  <p>Instead of <code>GET</code>, you can also use <code>POST</code> to query the changes feed. The only difference if you are using <code>POST</code> <em>and</em> you are using either of the <code>docs_ids</code> or <code>selector</code> filters, is that
    it is possible to include the <code>&quot;doc_ids&quot; : [...]</code> or <code>&quot;selector&quot;: {...}</code> parts in the request body. All other parameters are expected to be in the query string, the same as using <code>GET</code>.</p>
  <p><em>Example of using HTTP to <code>POST</code> to the <code>_changes</code> endpoint:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/$DB/_changes?filter=_selector</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: $USERNAME.cloudant.com
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
  <p><em>Example of using the command line to <code>POST</code> to the <code>_changes</code> endpoint:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl -X POST <span class="hljs-string">"https://<span class="hljs-variable">$USERNAME</span>.cloudant.com/<span class="hljs-variable">$DB</span>/_changes?filter=_selector"</span> <span class="hljs-_">-d</span> @request.json
</code></pre>
  <p><em>Example of a JSON object <code>POST</code>ed to the <code>_changes</code> endpoint:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"selector"</span>: {<span class="hljs-attr">"z"</span> : {<span class="hljs-attr">"$gte"</span> : <span class="hljs-number">1</span>}}
}
</code></pre>
  <h2 id="deleting-a-database">Deleting a database</h2>
  <p>To delete a database and its contents, send a <code>DELETE</code> request to <code>https://$USERNAME.cloudant.com/$DATABASE</code>.</p>
  <blockquote>
    <p> <strong>Note</strong>: No additional check is made to ensure that you really intended to delete the database (&quot;Are you sure?&quot;).</p>
  </blockquote>
  <p><em>Example of using HTTP to delete a Cloudant database:</em></p>
  <pre class="codeblock"><code class="lang-http hljs"><span class="hljs-keyword">DELETE</span> <span class="hljs-string">/$DATABASE</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: $USERNAME.cloudant.com
</code></pre>
  <p><em>Example of using the command line to delete a Cloudant database:</em></p>
  <pre class="codeblock"><code class="lang-sh hljs">curl https://<span class="hljs-variable">$USERNAME</span>.cloudant.com/<span class="hljs-variable">$DATABASE</span> \
    -X DELETE \
    -u <span class="hljs-variable">$USERNAME</span>
</code></pre>
  <!--

_Example of using JavaScript to delete a Cloudant database:_

```javascript
var nano = require('nano');
var account = nano("https://"+$USERNAME+":"+$PASSWORD+"@"+$USERNAME+".cloudant.com");

account.db.destroy($DATABASE, function (err, body, headers) {
    if (!err) {
        console.log(body);
    }
});
```

-->

  <p>The response confirms successful deletion of the database or describes any errors that occurred, for example if you try to delete a database that does not exist.</p>
  <p><em>Example response:</em></p>
  <pre class="codeblock"><code class="lang-json hljs">{
    <span class="hljs-attr">"ok"</span>: <span class="hljs-literal">true</span>
}
</code></pre>
  <h2 id="backing-up-your-data">Backing up your data</h2>
  <p>You must protect your data by taking good quality backups. An overview of backing up your data is <a href="backup.html">available</a>, with more detailed information in the <a href="../guides/backup-guide.html">backup guide</a>.</p>
  <h2 id="using-a-different-domain">Using a different domain</h2>
  <p>Virtual hosts (vhosts) are a way to make Cloudant serve data from a different domain than the one normally associated with your Cloudant account.</p>
  <p>More information is available <a href="vhosts.html">here</a>.</p>
  <h2 id="creating-database-applications">Creating database applications</h2>
  <p>In addition to data stored in documents within the database, you might also have client-side application code in documents within the database. The application code is typically written by using JavaScript. Two-tier combinations of data and client code,
    which is stored within a database, are called <a href="../guides/couchapps.html">CouchApps</a>.</p>
  <p>More information about CouchApps, and to help you decide whether they are a good match for your application, is <a href="../guides/couchapps.html">available</a>.</p>
  <footer>
    <div>
      <p>Copyright &copy; 2015, 2017. All Rights Reserved.</p>
    </div>
  </footer>
</body>
</html>