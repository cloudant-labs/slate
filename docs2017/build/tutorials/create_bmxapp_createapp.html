<html lang="en">
<head>
  <title>IBM&reg; Cloudant&reg; NoSQL DB for Bluemix&reg;</title>
  <meta charset="utf-8"></meta>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
  <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
</head>

<body>
  <!-- Acrolinx: 2017-01-11 -->

  <h1 id="creating-a-simple-bluemix-application-to-access-a-cloudant-database-the-code">Creating a simple Bluemix application to access a Cloudant database: the code</h1>
  <p class="shortdesc">This section of the tutorial describes the code for an IBM&reg; Bluemix&reg; application.</p>
  <div id="theApp"></div>
  <h2 id="creating-your-application">Creating your application</h2>
  <p>The following components are now in place, ready to begin creating the application:</p>
  <ul>
    <li><a href="create_bmxapp_prereq.html#python">The Python programming language</a>.</li>
    <li><a href="create_bmxapp_prereq.html#csi">A Cloudant NoSQL DB database instance</a>.</li>
    <li><a href="create_bmxapp_appenv.html#creating">A Bluemix application environment</a>.</li>
    <li>A <a href="create_bmxapp_appenv.html#connecting">connection</a> between the Cloudant NoSQL DB database instance and the Bluemix application environment.</li>
    <li>The <a href="create_bmxapp_appenv.html#toolkits">toolkits</a> for managing Cloud Foundry-based Bluemix applications.</li>
    <li>A <a href="create_bmxapp_appenv.html#starter">&#39;starter&#39; application pack</a>, containing initial configuration and code template files.</li>
  </ul>
  <blockquote>
    <p> <strong>Note</strong>: No attempt was made to create <em>efficient</em> Python code for this tutorial. The intention is to show simple and easy-to-understand working code that you can learn from and apply for your own applications. Also, no attempt
      was made to address all possible checks or error conditions. Some example checks are included to illustrate some of the techniques. In your applications, check for, and deal with, all warnings or error conditions.</p>
  </blockquote>
  <h3 id="essential-files">Essential files</h3>
  <p>Your application requires three configuration files and one source file, all available in the <a href="create_bmxapp_appenv.html#starter">&#39;starter&#39; application pack</a>:</p>
  <ul>
    <li><a href="create_bmxapp_appenv.html#procfile">&#39;<code>Procfile</code>&#39;</a></li>
    <li><a href="create_bmxapp_appenv.html#manifest">&#39;<code>manifest.yml</code>&#39;</a></li>
    <li><a href="create_bmxapp_appenv.html#requirements">&#39;<code>requirements.txt</code>&#39;</a></li>
    <li>The application source file, which is described in this section of the tutorial.</li>
  </ul>
  <p>Modify your configuration files as follows:</p>
  <ol>
    <li>
      <p>Edit the &#39;<code>Procfile</code>&#39; file so that it contains the following text:</p>
      <pre class="codeblock"><code class="hljs">web: python server.py
</code></pre>
    </li>
    <li>
      <p>Edit the &#39;<code>manifest.yml</code>&#39; file so that it contains the following text:</p>
      <pre class="codeblock"><code class="hljs">applications:
- path: .
  memory: 128M
  instances: 1
  domain: &lt;your domain&gt;
  name: &lt;your application name&gt;
  host: &lt;your application host&gt;
  disk_quota: 1024M
  services:
  - &lt;your database instance&gt;
</code></pre>
      <blockquote>
        <p> <strong>Note</strong>: Ensure that you modify the &#39;<code>domain</code>&#39;, &#39;<code>name</code>&#39;, &#39;<code>host</code>&#39;, and &#39;<code>services</code>&#39; values. They are the values that were entered when you created your
          <a href="create_bmxapp_appenv.html#creating">Bluemix application environment</a> and your <a href="create_bmxapp_prereq.html#csi">Cloudant NoSQL DB database instance</a>.</p>
      </blockquote>
    </li>
    <li>
      <p>Edit the &#39;<code>requirements.txt</code>&#39; file so that it contains the following text:</p>
      <pre class="codeblock"><code class="hljs">cloudant==2.3.1
</code></pre>
    </li>
  </ol>
  <h3 id="the-application-code">The application code</h3>
  <p>The next step is to work on the application code. Each section is described and the code is presented. A <a href="#complete-listing">complete listing</a> of the application code is at the end of this section of the tutorial.</p>
  <h4 id="getting-started">Getting started</h4>
  <p>The Python application requires some basic components to function. They are imported as follows:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Make Python modules available.</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># It is helpful to have access to tools</span>
<span class="hljs-comment"># for formatting date and time values.</span>
<span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> gmtime, strftime
</code></pre>
  <p>The application operates as a simple webserver, showing only one page: a log containing the results of connecting to the Cloudant NoSQL DB database instance and creating a database.</p>
  <p>The application requires components for serving a web page:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Simplify access to basic Python web server tools.</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">from</span> SimpleHTTPServer <span class="hljs-keyword">import</span> SimpleHTTPRequestHandler <span class="hljs-keyword">as</span> Handler
    <span class="hljs-keyword">from</span> SocketServer <span class="hljs-keyword">import</span> TCPServer <span class="hljs-keyword">as</span> Server
<span class="hljs-keyword">except</span> ImportError:
    <span class="hljs-keyword">from</span> http.server <span class="hljs-keyword">import</span> SimpleHTTPRequestHandler <span class="hljs-keyword">as</span> Handler
    <span class="hljs-keyword">from</span> http.server <span class="hljs-keyword">import</span> HTTPServer <span class="hljs-keyword">as</span> Server
</code></pre>
  <blockquote>
    <p> <strong>Note</strong>: This code segment is provided as part of the <a href="create_bmxapp_appenv.html#starter">&#39;starter&#39; application pack</a>.</p>
  </blockquote>
  <p>The application connects to the Cloudant NoSQL DB database instance, so it must import the Cloudant NoSQL DB Library components:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Enable the required Python libraries for working with Cloudant.</span>
<span class="hljs-keyword">from</span> cloudant.client <span class="hljs-keyword">import</span> Cloudant
<span class="hljs-keyword">from</span> cloudant.error <span class="hljs-keyword">import</span> CloudantException
<span class="hljs-keyword">from</span> cloudant.result <span class="hljs-keyword">import</span> Result, ResultByKey
</code></pre>
  <p>The application creates a database within the Cloudant NoSQL DB database instance. A name is required for the database:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># This is the name of the database we intend to create.</span>
databaseName = <span class="hljs-string">"databasedemo"</span>
</code></pre>
  <p>The application records progress as it connects to the Cloudant NoSQL DB database instance and creates the database. The record takes the form of a log file, which is stored in a folder accessible by the Python web server.</p>
  <p>Create a folder (called &#39;<code>static</code>&#39; in the application), and get ready to store a file in it:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Change current directory to avoid exposure of control files</span>
<span class="hljs-keyword">try</span>:
    os.mkdir(<span class="hljs-string">'static'</span>)
<span class="hljs-keyword">except</span> OSError:
    <span class="hljs-comment"># The directory already exists,</span>
    <span class="hljs-comment"># no need to create it.</span>
    <span class="hljs-keyword">pass</span>
os.chdir(<span class="hljs-string">'static'</span>)
</code></pre>
  <p>Next, create a simple HTML file. The file is going to contain the log of each activity as the application creates the database:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Begin creating a very simple web page.</span>
filename = <span class="hljs-string">"index.html"</span>
target = open(filename, <span class="hljs-string">'w'</span>)
target.truncate()
target.write(<span class="hljs-string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Cloudant Python Demo&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;Log of Cloudant Python steps...&lt;/p&gt;&lt;pre&gt;"</span>)
</code></pre>
  <p>The first part of the log is a record of the current date and time. This record helps confirm that the database really is being freshly created:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Put a clear indication of the current date and time at the top of the page.</span>
target.write(<span class="hljs-string">"====\n"</span>)
target.write(strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>, gmtime()))
target.write(<span class="hljs-string">"\n====\n\n"</span>)
</code></pre>
  <h4 id="working-with-the-cloudant-database-instance">Working with the Cloudant database instance</h4>
  <p>The Python application runs within a Bluemix application environment. The environment provides all the necessary information for the application to access connected services. The information is provided within an environment variable, called &#39;<code>VCAP_SERVICES</code>&#39;.
    This variable can be accessed by the application, and used to determine the connection details.</p>
  <p>The first task is to ensure that the application is running within a Bluemix application environment. Check by testing for the presence of the &#39;<code>VCAP_SERVICES</code>&#39; environment variable:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Check that we are running in a Bluemix application environment.</span>
<span class="hljs-keyword">if</span> <span class="hljs-string">'VCAP_SERVICES'</span> <span class="hljs-keyword">in</span> os.environ:
</code></pre>
  <blockquote>
    <p> <strong>Note</strong>: The next sections of code are run only if the environment variable was found. In Python, this code is indented to indicate that it is the body of the test. In this tutorial, indentation is omitted from the code segments to save
      space. However, the <a href="#complete-listing">full listing</a> shows the indentation correctly.</p>
  </blockquote>
  <p>Assuming that the variable is found, proceed to use the information. Start by loading the JSON data that is stored within the variable, and recording the event in the new &#39;log file&#39;:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Yes we are, so get the service information.</span>
vcap_servicesData = json.loads(os.environ[<span class="hljs-string">'VCAP_SERVICES'</span>])
<span class="hljs-comment"># Log the fact that we successfully found some service information.</span>
target.write(<span class="hljs-string">"Got vcap_servicesData\n"</span>)
</code></pre>
  <p>Next, look for information about the connected Cloudant NoSQL DB database instance. Again, record the event in the &#39;log file&#39;:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Look for the Cloudant service instance.</span>
cloudantNoSQLDBData = vcap_servicesData[<span class="hljs-string">'cloudantNoSQLDB'</span>]
<span class="hljs-comment"># Log the fact that we successfully found some Cloudant service information.</span>
target.write(<span class="hljs-string">"Got cloudantNoSQLDBData\n"</span>)
</code></pre>
  <p>Several Bluemix services might be connected to the application environment. The credentials for each service are listed as array elements. In this tutorial, only one <a href="create_bmxapp_appenv.html#connecting">service connection was created</a>.
    Therefore, the application accesses the first element (element &#39;zero&#39;). Each service element contains the credentials for that service, expressed as a list indexed by the essential field names that are needed to access the service. More information
    about the field names is provided in the
    <a href="create_database.html#a-cloudant-service-instance-on-bluemix">tutorial</a> that describes a simple database creation task.</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Get a list containing the Cloudant connection information.</span>
credentials = cloudantNoSQLDBData[<span class="hljs-number">0</span>]
<span class="hljs-comment"># Get the essential values for our application to talk to the service.</span>
credentialsData = credentials[<span class="hljs-string">'credentials'</span>]
<span class="hljs-comment"># Log the fact that we successfully found the Cloudant values.</span>
target.write(<span class="hljs-string">"Got credentialsData\n\n"</span>)
</code></pre>
  <p>Next, inspect the list and retrieve the essential values:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Get the username ...</span>
serviceUsername = credentialsData[<span class="hljs-string">'username'</span>]
target.write(<span class="hljs-string">"Got username: "</span>)
target.write(serviceUsername)
target.write(<span class="hljs-string">"\n"</span>)
<span class="hljs-comment"># ... the password ...</span>
servicePassword = credentialsData[<span class="hljs-string">'password'</span>]
target.write(<span class="hljs-string">"Got password: "</span>)
target.write(servicePassword)
target.write(<span class="hljs-string">"\n"</span>)
<span class="hljs-comment"># ... and the URL of the service within Bluemix.</span>
serviceURL = credentialsData[<span class="hljs-string">'url'</span>]
target.write(<span class="hljs-string">"Got URL: "</span>)
target.write(serviceURL)
target.write(<span class="hljs-string">"\n"</span>)
</code></pre>
  <p>The application now has all the details necessary to create a database within the Cloudant NoSQL DB database instance. This task is described in more detail in the
    <a href="create_database.html#a-cloudant-service-instance-on-bluemix">tutorial</a> that describes simple database creation.</p>
  <p>The application must do these tasks:</p>
  <ol>
    <li>Establishes a connection to the database instance.</li>
    <li>Creates a database with the name provided <a href="#getting-started">earlier</a>.</li>
    <li>Creates a JSON document that contains the current date and time.</li>
    <li>Stores the JSON document in the database.</li>
    <li>Confirms that the document was stored safely.</li>
    <li>Closes the connection to the database instance.</li>
  </ol>
  <p>The code for these tasks is as follows:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># We now have all the details we need to work with the Cloudant service instance.</span>
<span class="hljs-comment"># Connect to the service instance.</span>
client = Cloudant(serviceUsername, servicePassword, url=serviceURL)
client.connect()
<span class="hljs-comment"># Create a database within the instance.</span>
myDatabaseDemo = client.create_database(databaseName)
<span class="hljs-keyword">if</span> myDatabaseDemo.exists():
    target.write(<span class="hljs-string">"'{0}' successfully created.\n"</span>.format(databaseName))
    <span class="hljs-comment"># Create a very simple JSON document with the current date and time.</span>
    jsonDocument = {
        <span class="hljs-string">"rightNow"</span>: strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>, gmtime())
    }
    <span class="hljs-comment"># Store the JSON document in the database.</span>
    newDocument = myDatabaseDemo.create_document(jsonDocument)
    <span class="hljs-keyword">if</span> newDocument.exists():
        target.write(<span class="hljs-string">"Document successfully created.\n"</span>)
<span class="hljs-comment"># All done - disconnect from the service instance.</span>
client.disconnect()
</code></pre>
  <h4 id="closing-the-log-file">Closing the log file</h4>
  <p>The next step is to finish the log file, ready to serve it using a simple Python web server within the application:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Put another clear indication of the current date and time at the bottom of the page.</span>
target.write(<span class="hljs-string">"\n====\n"</span>)
target.write(strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>, gmtime()))
target.write(<span class="hljs-string">"\n====\n"</span>)
<span class="hljs-comment"># Finish creating the web page.</span>
target.write(<span class="hljs-string">"&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;"</span>)
target.close()
</code></pre>
  <h4 id="serving-the-log-file">Serving the log file</h4>
  <p>The final task is to start the web server within the Python application. The sole purpose of the server is to return the log file on request. This log file confirms that the Python application successfully completed the following tasks:</p>
  <ol>
    <li>Ran successfully within the Bluemix application environment.</li>
    <li>Determined the details for service connections.</li>
    <li>Connected to a Cloudant NoSQL DB database instance.</li>
    <li>Created a database.</li>
    <li>Created a document within the database.</li>
    <li>Replied with the log of events when requested.</li>
  </ol>
  <p>The code for starting the Python web server is included as part of the
    <a href="create_bmxapp_appenv.html#starter">&#39;starter&#39; application pack</a>:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Start up the simple Python web server application,</span>
<span class="hljs-comment"># so that it can 'serve' our newly created web page.</span>
PORT = int(os.getenv(<span class="hljs-string">'PORT'</span>, <span class="hljs-number">8000</span>))
httpd = Server((<span class="hljs-string">""</span>, PORT), Handler)
<span class="hljs-keyword">try</span>:
  print(<span class="hljs-string">"Start serving at port %i"</span> % PORT)
  httpd.serve_forever()
<span class="hljs-keyword">except</span> KeyboardInterrupt:
  <span class="hljs-keyword">pass</span>
httpd.server_close()
</code></pre>
  <h2 id="the-next-step">The next step</h2>
  <p>The next step in the tutorial is to <a href="create_bmxapp_upload.html">upload the application</a> for testing purposes.</p>
  <h2 id="complete-listing">Complete listing</h2>
  <p>The following code is the complete Python program to access a Cloudant NoSQL DB service instance on Bluemix:</p>
  <pre class="codeblock"><code class="lang-python hljs"><span class="hljs-comment"># Make Python modules available.</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># It is helpful to have access to tools</span>
<span class="hljs-comment"># for formatting date and time values.</span>
<span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> gmtime, strftime

<span class="hljs-comment"># Simplify access to basic Python web server tools.</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">from</span> SimpleHTTPServer <span class="hljs-keyword">import</span> SimpleHTTPRequestHandler <span class="hljs-keyword">as</span> Handler
    <span class="hljs-keyword">from</span> SocketServer <span class="hljs-keyword">import</span> TCPServer <span class="hljs-keyword">as</span> Server
<span class="hljs-keyword">except</span> ImportError:
    <span class="hljs-keyword">from</span> http.server <span class="hljs-keyword">import</span> SimpleHTTPRequestHandler <span class="hljs-keyword">as</span> Handler
    <span class="hljs-keyword">from</span> http.server <span class="hljs-keyword">import</span> HTTPServer <span class="hljs-keyword">as</span> Server

<span class="hljs-comment"># Enable the required Python libraries for working with Cloudant.</span>
<span class="hljs-keyword">from</span> cloudant.client <span class="hljs-keyword">import</span> Cloudant
<span class="hljs-keyword">from</span> cloudant.error <span class="hljs-keyword">import</span> CloudantException
<span class="hljs-keyword">from</span> cloudant.result <span class="hljs-keyword">import</span> Result, ResultByKey

<span class="hljs-comment"># This is the name of the database we intend to create.</span>
databaseName = <span class="hljs-string">"databasedemo"</span>

<span class="hljs-comment"># Change current directory to avoid exposure of control files</span>
<span class="hljs-keyword">try</span>:
    os.mkdir(<span class="hljs-string">'static'</span>)
<span class="hljs-keyword">except</span> OSError:
    <span class="hljs-comment"># The directory already exists,</span>
    <span class="hljs-comment"># no need to create it.</span>
    <span class="hljs-keyword">pass</span>
os.chdir(<span class="hljs-string">'static'</span>)

<span class="hljs-comment"># Begin creating a very simple web page.</span>
filename = <span class="hljs-string">"index.html"</span>
target = open(filename, <span class="hljs-string">'w'</span>)
target.truncate()
target.write(<span class="hljs-string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Cloudant Python Demo&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;Log of Cloudant Python steps...&lt;/p&gt;&lt;pre&gt;"</span>)

<span class="hljs-comment"># Put a clear indication of the current date and time at the top of the page.</span>
target.write(<span class="hljs-string">"====\n"</span>)
target.write(strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>, gmtime()))
target.write(<span class="hljs-string">"\n====\n\n"</span>)

<span class="hljs-comment"># Start working with the Cloudant service instance.</span>

<span class="hljs-comment"># Check that we are running in a Bluemix application environment.</span>
<span class="hljs-keyword">if</span> <span class="hljs-string">'VCAP_SERVICES'</span> <span class="hljs-keyword">in</span> os.environ:
    <span class="hljs-comment"># Yes we are, so get the service information.</span>
    vcap_servicesData = json.loads(os.environ[<span class="hljs-string">'VCAP_SERVICES'</span>])
    <span class="hljs-comment"># Log the fact that we successfully found some service information.</span>
    target.write(<span class="hljs-string">"Got vcap_servicesData\n"</span>)
    <span class="hljs-comment"># Look for the Cloudant service instance.</span>
    cloudantNoSQLDBData = vcap_servicesData[<span class="hljs-string">'cloudantNoSQLDB'</span>]
    <span class="hljs-comment"># Log the fact that we successfully found some Cloudant service information.</span>
    target.write(<span class="hljs-string">"Got cloudantNoSQLDBData\n"</span>)
    <span class="hljs-comment"># Get a list containing the Cloudant connection information.</span>
    credentials = cloudantNoSQLDBData[<span class="hljs-number">0</span>]
    <span class="hljs-comment"># Get the essential values for our application to talk to the service.</span>
    credentialsData = credentials[<span class="hljs-string">'credentials'</span>]
    <span class="hljs-comment"># Log the fact that we successfully found the Cloudant values.</span>
    target.write(<span class="hljs-string">"Got credentialsData\n\n"</span>)
    <span class="hljs-comment"># Get the username ...</span>
    serviceUsername = credentialsData[<span class="hljs-string">'username'</span>]
    target.write(<span class="hljs-string">"Got username: "</span>)
    target.write(serviceUsername)
    target.write(<span class="hljs-string">"\n"</span>)
    <span class="hljs-comment"># ... the password ...</span>
    servicePassword = credentialsData[<span class="hljs-string">'password'</span>]
    target.write(<span class="hljs-string">"Got password: "</span>)
    target.write(servicePassword)
    target.write(<span class="hljs-string">"\n"</span>)
    <span class="hljs-comment"># ... and the URL of the service within Bluemix.</span>
    serviceURL = credentialsData[<span class="hljs-string">'url'</span>]
    target.write(<span class="hljs-string">"Got URL: "</span>)
    target.write(serviceURL)
    target.write(<span class="hljs-string">"\n"</span>)

    <span class="hljs-comment"># We now have all the details we need to work with the Cloudant service instance.</span>
    <span class="hljs-comment"># Connect to the service instance.</span>
    client = Cloudant(serviceUsername, servicePassword, url=serviceURL)
    client.connect()
    <span class="hljs-comment"># Create a database within the instance.</span>
    myDatabaseDemo = client.create_database(databaseName)
    <span class="hljs-keyword">if</span> myDatabaseDemo.exists():
        target.write(<span class="hljs-string">"'{0}' successfully created.\n"</span>.format(databaseName))
        <span class="hljs-comment"># Create a very simple JSON document with the current date and time.</span>
        jsonDocument = {
            <span class="hljs-string">"rightNow"</span>: strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>, gmtime())
        }
        <span class="hljs-comment"># Store the JSON document in the database.</span>
        newDocument = myDatabaseDemo.create_document(jsonDocument)
        <span class="hljs-keyword">if</span> newDocument.exists():
            target.write(<span class="hljs-string">"Document successfully created.\n"</span>)
    <span class="hljs-comment"># All done - disconnect from the service instance.</span>
    client.disconnect()

<span class="hljs-comment"># Put another clear indication of the current date and time at the bottom of the page.</span>
target.write(<span class="hljs-string">"\n====\n"</span>)
target.write(strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>, gmtime()))
target.write(<span class="hljs-string">"\n====\n"</span>)
<span class="hljs-comment"># Finish creating the web page.</span>
target.write(<span class="hljs-string">"&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;"</span>)
target.close()

<span class="hljs-comment"># Start up the simple Python web server application,</span>
<span class="hljs-comment"># so that it can 'serve' our newly created web page.</span>
PORT = int(os.getenv(<span class="hljs-string">'PORT'</span>, <span class="hljs-number">8000</span>))
httpd = Server((<span class="hljs-string">""</span>, PORT), Handler)
<span class="hljs-keyword">try</span>:
  print(<span class="hljs-string">"Start serving at port %i"</span> % PORT)
  httpd.serve_forever()
<span class="hljs-keyword">except</span> KeyboardInterrupt:
  <span class="hljs-keyword">pass</span>
httpd.server_close()
</code></pre>
  <footer>
    <div>
      <p>Copyright &copy; 2015, 2017. All Rights Reserved.</p>
    </div>
  </footer>
</body>
</html>