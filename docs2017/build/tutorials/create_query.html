<html lang="en">
<head>
  <title>IBM&reg; Cloudant&reg; NoSQL DB for Bluemix&reg;</title>
  <meta charset="utf-8"></meta>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
  <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
</head>

<body>
  <h1 id="creating-a-cloudant-query">Creating a Cloudant Query</h1>
  <p>This tutorial demonstrates how to create an index and extract specific data from the database using a query.</p>
  <p>[Description of query elements.]</p>
  <h2 id="creating-a-database-using-the-cloudant-dashboard">Creating a database using the Cloudant Dashboard</h2>
  <p>This tutorial is based on the <code>rolodex</code> database that you are going to create. </p>
  <ol>
    <li>Create a Cloudant account <a href="https://cloudant.com/sign-in/">here</a> if you do not already have one.</li>
    <li>Log in to the Cloudant Dashboard. </li>
    <li>Verify that the Databases tab is selected in the left navigation. </li>
    <li>Click <strong>Create Database</strong>. </li>
    <li>Enter <code>rolodex</code> as the name for the database and click <strong>Create</strong>. The <code>rolodex</code> database automatically opens. </li>
    <li>Click <strong>+</strong> next to All Documents and select <strong>New Doc</strong>. The New Document window displays. </li>
    <li>Create a new document by inserting the following text after the &quot;_id&quot; line and inside the brackets. </li>
  </ol>
  <pre><code class="lang-json hljs">  ,
  &quot;firstname&quot;: &quot;Sally&quot;,
  &quot;lastname&quot;: &quot;Brown&quot;,
  &quot;sex&quot;: &quot;female&quot;,
  &quot;address&quot;: &quot;122 Main Street&quot;,
  &quot;city&quot;: &quot;Peoria&quot;,
  &quot;state&quot;: &quot;IL&quot;,
  &quot;zipcode&quot;: 61602,
  &quot;areacode&quot;: 309,
  &quot;phonenumber&quot;: &quot;334-9354&quot;
</code></pre>
  <ol>
    <li>Repeat the steps 6 and 7 to create nine new documents using the text below. </li>
  </ol>
  <p>Document 1</p>
  <pre><code class="lang-json hljs">   ,
  &quot;firstname&quot;: &quot;John&quot;,
  &quot;lastname&quot;: &quot;Smith&quot;,
  &quot;sex&quot;: &quot;male&quot;,
  &quot;address&quot;: &quot;123 Main Street&quot;,
  &quot;city&quot;: &quot;Peoria&quot;,
  &quot;state&quot;: &quot;IL&quot;,
  &quot;zipcode&quot;: 61602,
  &quot;areacode&quot;: 309,
  &quot;phonenumber&quot;: &quot;334-4614&quot;
</code></pre>
  <p>Document 2</p>
  <pre><code class="lang-json hljs">   ,
  &quot;firstname&quot;: &quot;Greg&quot;,
  &quot;lastname&quot;: &quot;Greene&quot;,
  &quot;sex&quot;: &quot;male&quot;,
  &quot;address&quot;: &quot;124 Main Street&quot;,
  &quot;city&quot;: &quot;Peoria&quot;,
  &quot;state&quot;: &quot;IL&quot;,
  &quot;zipcode&quot;: 61602,
  &quot;areacode&quot;: 309,
  &quot;phonenumber&quot;: &quot;334-4445&quot;
</code></pre>
  <p>Document 3</p>
  <pre><code class="lang-json hljs">   ,
  &quot;firstname&quot;: &quot;Dan&quot;,
  &quot;lastname&quot;: &quot;Brown&quot;,
  &quot;sex&quot;: &quot;male&quot;,
  &quot;address&quot;: &quot;125 Main Street&quot;,
  &quot;city&quot;: &quot;Peoria&quot;,
  &quot;state&quot;: &quot;IL&quot;,
  &quot;zipcode&quot;: 61602,
  &quot;areacode&quot;: 309,
  &quot;phonenumber&quot;: &quot;334-4275&quot;
</code></pre>
  <p>Document 4</p>
  <pre><code class="lang-json hljs">   ,
    &quot;firstname&quot;: &quot;Janine&quot;,
    &quot;lastname&quot;: &quot;Lee&quot;,
    &quot;sex&quot;: &quot;female&quot;,
    &quot;address&quot;: &quot;126 Second Street&quot;, 
    &quot;city&quot;: &quot;San Mateo&quot;, 
    &quot;state&quot;: &quot;CA&quot;,
    &quot;zipcode&quot;: 94401,
    &quot;areacode&quot;: 650,
    &quot;phonenumber&quot;: &quot;726-9938&quot;
</code></pre>
  <p>Document 5</p>
  <pre><code class="lang-json hljs">   ,
  &quot;firstname&quot;: &quot;Sam&quot;,
  &quot;lastname&quot;: &quot;Harris&quot;,
  &quot;sex&quot;: &quot;male&quot;,
  &quot;address&quot;: &quot;125 Second Street&quot;,
  &quot;city&quot;: &quot;San Mateo&quot;,
  &quot;state&quot;: &quot;CA&quot;,
  &quot;zipcode&quot;: 94401,
  &quot;areacode&quot;: 650,
  &quot;phonenumber&quot;: &quot;225-4444&quot;
</code></pre>
  <p>Document 6</p>
  <pre><code class="lang-json hljs">   ,
  &quot;firstname&quot;: &quot;Amanda&quot;,
  &quot;lastname&quot;: &quot;Greene&quot;,
  &quot;sex&quot;: &quot;female&quot;,
  &quot;address&quot;: &quot;124 Second Street&quot;,
  &quot;city&quot;: &quot;San Mateo&quot;,
  &quot;state&quot;: &quot;CA&quot;,
  &quot;zipcode&quot;: 94401,
  &quot;areacode&quot;: 650,
  &quot;phonenumber&quot;: &quot;613-8462&quot;
</code></pre>
  <p>Document 7</p>
  <pre><code class="lang-json hljs">    ,
    &quot;firstname&quot;: &quot;Tammy&quot;,
    &quot;lastname&quot;: &quot;Smith&quot;,
    &quot;sex&quot;: &quot;female&quot;,
    &quot;address&quot;: &quot;122 Second Street&quot;, 
    &quot;city&quot;: &quot;San Mateo&quot;, 
    &quot;state&quot;: &quot;CA&quot;,
    &quot;zipcode&quot;: 94401,
    &quot;areacode&quot;: 650,
    &quot;phonenumber&quot;: &quot;333-7310&quot;
</code></pre>
  <p>Document 8</p>
  <pre><code class="lang-json hljs">    ,
    &quot;firstname&quot;: &quot;Patricia&quot;,
    &quot;lastname&quot;: &quot;Jones&quot;,
    &quot;sex&quot;: &quot;female&quot;,
    &quot;address&quot;: &quot;125 Second Street&quot;, 
    &quot;city&quot;: &quot;San Mateo&quot;, 
    &quot;state&quot;: &quot;CA&quot;,
    &quot;zipcode&quot;: 94401,
    &quot;areacode&quot;: 650,
    &quot;phonenumber&quot;: &quot;336-4003&quot;
</code></pre>
  <p>Document 9</p>
  <pre><code class="lang-json hljs">    ,
    &quot;firstname&quot;: &quot;Nick&quot;,
    &quot;lastname&quot;: &quot;Brown&quot;,
    &quot;sex&quot;: &quot;male&quot;,
    &quot;address&quot;: &quot;126 Second Street&quot;, 
    &quot;city&quot;: &quot;San Mateo&quot;, 
    &quot;state&quot;: &quot;CA&quot;,
    &quot;zipcode&quot;: 94401,
    &quot;areacode&quot;: 650,
    &quot;phonenumber&quot;: &quot;334-4841&quot;
</code></pre>
  <p>The <code>rolodex</code> database now contains ten JSON documents. </p>
  <h2 id="creating-a-design-document">Creating a design document</h2>
  <p>You configure a search index or a MapReduce view by adding Design Documents to the database. Design Documents contain instructions about how the view or index must be built. When you change the Design Document, the index is overwritten and recreated
    from scratch.</p>
  <ol>
    <li>From the Dashboard, open the <code>rolodex</code> database.</li>
    <li>On the Design Doc tab, click <strong>+</strong> and select <strong>New Doc</strong>. </li>
    <li>Replace the <code>_id</code> with <code>rolodex-index-design-doc</code> and click <strong>Create Document</strong>. The Design Document is added to the list of documents in the database. </li>
  </ol>
  <p>The index and view information for this tutorial will be stored in this Design Document. </p>
  <h2 id="creating-an-index">Creating an index</h2>
  <p>With Cloudant Query, you can build indexes using MapReduce Views (type=json) and Search Indexes (type=text). The <code>rolodex</code> database contains the following columns:</p>
  <ul>
    <li>Firstname</li>
    <li>Lastname</li>
    <li>Sex</li>
    <li>Address</li>
    <li>City</li>
    <li>State</li>
    <li>Zipcode</li>
    <li>Areacode</li>
    <li>Phone number</li>
  </ul>
  <h3 id="creating-a-type-json-index">Creating a &quot;type=json&quot; index</h3>
  <p>Creating an index can reduce the load on your environment as well as the size of your data set. You select a subset of the columns listed in the table in the database to do this. You select the columns by specifying them in the <code>fields</code> parameter
    as shown in the request below. </p>
  <ol>
    <li>Create an index with <code>type=JSON</code> specified by making a <code>POST</code> request to the <code>_index</code> endpoint.</li>
    <li>In the request body for the JSON object, specify the <code>state</code> and <code>area code</code> fields. </li>
    <li>Set the <code>type</code> field equal to <code>json</code>. </li>
  </ol>
  <pre><code class="lang-json hljs">POST /rolodex/_index HTTP/1.1
Content-Type: application/json
    {
        &quot;index&quot;: {
            &quot;fields&quot;: [
                {
                   &quot;state&quot;, &quot;area code&quot;
                    }
                ]                    
        },
        &quot;name&quot; : &quot;rolodex-json&quot;,
        &quot;type&quot; : &quot;json&quot;
}
</code></pre>
  <p>Return JSON confirms the index was created successfully.</p>
  <pre><code class="hljs">    {
        &quot;result&quot; : &quot;created&quot;
    }
</code></pre>
  <h3 id="creating-a-type-text-index">Creating a &quot;type=text&quot; index</h3>
  <p>If you want to search all your data, you can create a &quot;type=text&quot; index. A &quot;type=text&quot; index automatically indexes all the documents and fields in your database which allows you to query and retrieve information from all the data
    in your database. </p>
  <ol>
    <li>Create a text type index by making a <code>POST</code> request to the <code>_index</code> enpoint.</li>
    <li>In the request body for the JSON object, specify the <code>sex</code>, <code>lastname</code>, and <code>areacode</code> fields. </li>
    <li>Set the <code>type</code> equal to <code>text</code> to specify a text type index. </li>
  </ol>
  <pre><code class="lang-json hljs">POST /rolodex/_index HTTP/1.1
Content-Type: application/json
{
    &quot;type&quot;: &quot;text&quot; 
    &quot;name&quot;: &quot;rolodex-text&quot;,
    &quot;ddoc&quot;: &quot;rolodex-index-design-doc&quot;,            
    &quot;index&quot;: {
       &quot;default_field&quot;: {
            &quot;enabled&quot;: true,
            &quot;analyzer&quot;: &quot;standard&quot;
            },            
        &quot;selector&quot;: {},
                &quot;fields&quot;: [
                    {&quot;name&quot;: &quot;sex&quot;, &quot;type&quot;: &quot;string&quot;},
                    {&quot;name&quot;: &quot;lastname&quot;, &quot;type&quot;: &quot;string&quot;},
                    {&quot;name&quot;: &quot;areacode&quot;, &quot;type&quot;: &quot;number&quot;}
               ]
        }   
}
</code></pre>
  <h3 id="listing-cloudant-query-indexes">Listing Cloudant Query indexes</h3>
  <p>Now, list all the indexes in the <code>rolodex</code> database by using the GET command. </p>
  <pre><code class="hljs">    GET /rolodex/_index
</code></pre>
  <p>Return JSON lists the indexes in the database.</p>
  <pre><code class="hljs">{&quot;total_rows&quot;:2,&quot;indexes&quot;:[{&quot;ddoc&quot;:null,&quot;name&quot;:&quot;_all_docs&quot;,&quot;type&quot;:&quot;special&quot;,&quot;def&quot;:{&quot;fields&quot;:[{&quot;_id&quot;:&quot;asc&quot;}]}},{&quot;ddoc&quot;:&quot;_design/a7ee061f1a2c0c6882258b2f1e148b714e79ccea&quot;,&quot;name&quot;:&quot;a7ee061f1a2c0c6882258b2f1e148b714e79ccea&quot;,&quot;type&quot;:&quot;json&quot;,&quot;def&quot;:{&quot;fields&quot;:[{&quot;foo&quot;:&quot;asc&quot;}]}}]}
</code></pre>
  <h2 id="creating-a-query">Creating a query</h2>
  <p>You can narrow the data you search by using <a href="cloudant_query.html#selector-syntax">selector syntax</a> or operators, (<a href="cloudant_query.html#implicit-operators">implicit</a> or <a href="cloudant_query.html#explicit-operators">explicit</a>)
    when you write your query statement. </p>
  <h3 id="querying-the-database-using-selector-syntax">Querying the database using selector syntax</h3>
  <p>The following request uses selector syntax to search the <code>rolodex</code> database. This query will find documents with the last name is <code>Greene</code>. </p>
  <p>In this example, you must type in the name of the field to search after the <code>selector</code> field. In this case, type in the lastname field and tthe selector syntax uses the field to search, </p>
  <ol>
    <li>After <code>selector</code>, type in <code>&quot;lastname&quot;: &quot;Greene&quot;</code> to find all the documents with the last name Greene.</li>
    <li>Type in <code>firstname</code> and <code>lastname</code>. These are the fields that display with the results. </li>
    <li>Type in <code>lastname</code> to sort the results&#39; list by the last name.</li>
  </ol>
  <pre><code class="hljs">POST /rolodex/_find
{
    &quot;selector&quot;: {
        &quot;lastname&quot;: &quot;Greene&quot;
        }
         &quot;fields&quot;: [&quot;firstname&quot;, &quot;lastname&quot;],
         &quot;sort&quot;: [&quot;firstname&quot;]
    }
</code></pre>
  <p>Results from the search.</p>
  <pre><code class="hljs">{
  &quot;docs&quot;: [
    {     
        &quot;firstname&quot;: &quot;Amanda&quot;,
        &quot;lastname&quot;: &quot;Greene&quot;,
        &quot;city&quot;: &quot;San Mateo&quot;,        
        &quot;state&quot;: &quot;CA&quot;
        }
   {
        &quot;firstname&quot;: &quot;Greg&quot;,
        &quot;lastname&quot;: &quot;Greene&quot;,
        &quot;city&quot;: &quot;Peoria&quot;,
        &quot;state&quot;: &quot;IL&quot;,
        }
     ]
}
</code></pre>
  <h3 id="querying-the-database-using-the-and-operator">Querying the database using the <code>$and</code> operator</h3>
  <p>[Search for people who live in California and have a 650 area code.] The following request uses selector syntax and the explicit operator <code>$and</code>. In this case, the query will find the documents in the database with a female who has a 650
    area code. </p>
  <ol>
    <li>After <code>selector</code>, type in <code>&quot;lastname&quot;: &quot;Greene&quot;</code> to find all the documents with the last name Greene.</li>
    <li>Type in <code>firstname</code> and <code>lastname</code>. These are the fields that display with the results. </li>
    <li>Type in <code>lastname</code> to sort the results&#39; list by the last name.</li>
  </ol>
  <pre><code class="hljs">POST /rolodex/_find
{
    &quot;selector&quot;: {
        &quot;$and&quot;: [
             {
                &quot;$text&quot;: &quot;female&quot;
            },
            {
                &quot;areacode&quot;: 650
                }
            }
    ]
   },
        &quot;fields&quot;: [
            &quot;firstname&quot;, &quot;lastname&quot;, &quot;areacode&quot;]  
    }
</code></pre>
  <p>Results from the search. </p>
  <pre><code class="hljs">{
  &quot;docs&quot;: [
 {     
    &quot;firstname&quot;: &quot;Janine&quot;,
    &quot;lastname&quot;: &quot;Lee&quot;,
    &quot;areacode&quot;: 650
       }
 {
    &quot;firstname&quot;: &quot;Amanda&quot;,
    &quot;lastname&quot;: &quot;Greene&quot;,
    &quot;areacode&quot;: 650        
       }

 {  
     &quot;firstname&quot;: &quot;Tammy&quot;,
     &quot;lastname&quot;: &quot;Smith&quot;,
     &quot;areacode&quot;: 650 
       }
 {
    &quot;firstname&quot;: &quot;Patricia&quot;,
    &quot;lastname&quot;: &quot;Jones&quot;,
       &quot;areacode&quot;: 650 
       }
     ]
}
</code></pre>
  <footer>
    <div>
      <p>Copyright &copy; 2015, 2017. All Rights Reserved.</p>
    </div>
  </footer>
</body>
</html>